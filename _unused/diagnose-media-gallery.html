<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎØ∏ÎîîÏñ¥ Í∞§Îü¨Î¶¨ ÏßÑÎã® ÎèÑÍµ¨</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #007AFF;
            border-bottom: 2px solid #007AFF;
            padding-bottom: 10px;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .section h2 {
            color: #40d372;
            margin-top: 0;
        }
        
        pre {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 12px;
            line-height: 1.5;
        }
        
        .success {
            color: #40d372;
        }
        
        .error {
            color: #ff453a;
        }
        
        .warning {
            color: #ffd60a;
        }
        
        .info {
            color: #007AFF;
        }
        
        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            background: #0051D5;
        }
        
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .image-item {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
        }
        
        .image-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .image-info {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.4;
        }
        
        .highlight {
            background: rgba(255, 255, 0, 0.2);
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç ÎØ∏ÎîîÏñ¥ Í∞§Îü¨Î¶¨ ÏßÑÎã® ÎèÑÍµ¨</h1>
        
        <div class="section">
            <h2>1. localStorage ÌÇ§ Í≤ÄÏÇ¨</h2>
            <button onclick="checkLocalStorageKeys()">localStorage ÌÇ§ ÌôïÏù∏</button>
            <button onclick="checkStoryboardData()">storyboardData Íµ¨Ï°∞ ÌôïÏù∏</button>
            <button onclick="findAllImages()">Î™®Îì† Ïù¥ÎØ∏ÏßÄ Ï∞æÍ∏∞</button>
            <div id="localStorage-keys"></div>
        </div>
        
        <div class="section">
            <h2>2. Ïä§ÌÜ†Î¶¨Î≥¥Îìú Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞ Î∂ÑÏÑù</h2>
            <div id="data-structure"></div>
        </div>
        
        <div class="section">
            <h2>3. Ïù¥ÎØ∏ÏßÄ ÌïÑÎìú Îß§Ìïë</h2>
            <div id="image-mapping"></div>
        </div>
        
        <div class="section">
            <h2>4. Î∞úÍ≤¨Îêú Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞</h2>
            <div id="found-images"></div>
        </div>
        
        <div class="section">
            <h2>5. Î¨∏Ï†ú ÏßÑÎã® Í≤∞Í≥º</h2>
            <div id="diagnosis"></div>
        </div>
    </div>
    
    <script>
        // localStorage ÌÇ§ ÌôïÏù∏
        function checkLocalStorageKeys() {
            const output = document.getElementById('localStorage-keys');
            let html = '<h3>Î∞úÍ≤¨Îêú localStorage ÌÇ§:</h3><ul>';
            
            const keys = Object.keys(localStorage);
            keys.forEach(key => {
                const size = localStorage.getItem(key).length;
                const sizeKB = (size / 1024).toFixed(2);
                
                if (key.toLowerCase().includes('storyboard') || 
                    key.toLowerCase().includes('breakdown') || 
                    key.toLowerCase().includes('shot')) {
                    html += `<li class="success"><strong>${key}</strong> (${sizeKB} KB)</li>`;
                } else {
                    html += `<li>${key} (${sizeKB} KB)</li>`;
                }
            });
            
            html += '</ul>';
            output.innerHTML = html;
        }
        
        // storyboardData Íµ¨Ï°∞ ÌôïÏù∏
        function checkStoryboardData() {
            const output = document.getElementById('data-structure');
            const storyboardData = localStorage.getItem('storyboardData');
            
            if (!storyboardData) {
                output.innerHTML = '<p class="error">‚ùå storyboardDataÍ∞Ä localStorageÏóê ÏóÜÏäµÎãàÎã§!</p>';
                return;
            }
            
            try {
                const data = JSON.parse(storyboardData);
                let html = '<h3>storyboardData Íµ¨Ï°∞:</h3>';
                
                // Îç∞Ïù¥ÌÑ∞ Íµ¨Ï°∞ Î∂ÑÏÑù
                html += '<h4>ÏµúÏÉÅÏúÑ ÌÇ§:</h4><ul>';
                Object.keys(data).forEach(key => {
                    html += `<li class="info">${key}`;
                    
                    if (key === 'breakdown_data' && data[key]) {
                        html += '<ul>';
                        Object.keys(data[key]).forEach(subKey => {
                            if (subKey === 'shots' && Array.isArray(data[key][subKey])) {
                                html += `<li class="success"><strong>${subKey}</strong> (Î∞∞Ïó¥, ${data[key][subKey].length}Í∞ú Ìï≠Î™©)</li>`;
                                
                                // Ï≤´ Î≤àÏß∏ ÏÉ∑Ïùò Íµ¨Ï°∞ ÌëúÏãú
                                if (data[key][subKey].length > 0) {
                                    const firstShot = data[key][subKey][0];
                                    html += '<li>Ï≤´ Î≤àÏß∏ ÏÉ∑Ïùò ÌÇ§Îì§:<ul>';
                                    Object.keys(firstShot).forEach(shotKey => {
                                        const value = firstShot[shotKey];
                                        const type = Array.isArray(value) ? 'array' : typeof value;
                                        
                                        if (shotKey.includes('image') || shotKey.includes('video')) {
                                            html += `<li class="warning"><strong>${shotKey}</strong> (${type})</li>`;
                                        } else {
                                            html += `<li>${shotKey} (${type})</li>`;
                                        }
                                    });
                                    html += '</ul></li>';
                                }
                            } else {
                                html += `<li>${subKey}</li>`;
                            }
                        });
                        html += '</ul>';
                    }
                    
                    html += '</li>';
                });
                html += '</ul>';
                
                // Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞Î•º JSONÏúºÎ°ú ÌëúÏãú
                html += '<h4>Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ (Ï∂ïÏïΩ):</h4>';
                html += `<pre>${JSON.stringify(data, null, 2).substring(0, 2000)}...</pre>`;
                
                output.innerHTML = html;
            } catch (e) {
                output.innerHTML = `<p class="error">‚ùå ÌååÏã± Ïò§Î•ò: ${e.message}</p>`;
            }
        }
        
        // Î™®Îì† Ïù¥ÎØ∏ÏßÄ Ï∞æÍ∏∞
        function findAllImages() {
            const output = document.getElementById('image-mapping');
            const imagesDiv = document.getElementById('found-images');
            const diagnosisDiv = document.getElementById('diagnosis');
            
            const storyboardData = localStorage.getItem('storyboardData');
            
            if (!storyboardData) {
                output.innerHTML = '<p class="error">‚ùå storyboardDataÍ∞Ä ÏóÜÏäµÎãàÎã§!</p>';
                return;
            }
            
            try {
                const data = JSON.parse(storyboardData);
                let foundImages = [];
                let imageFields = new Set();
                let problems = [];
                
                // Ïû¨Í∑ÄÏ†ÅÏúºÎ°ú Î™®Îì† URL Ï∞æÍ∏∞
                function findUrls(obj, path = '') {
                    if (!obj) return;
                    
                    if (typeof obj === 'string') {
                        // URL Ìå®ÌÑ¥ Ï≤¥ÌÅ¨
                        if ((obj.includes('http://') || obj.includes('https://') || obj.includes('data:image')) && 
                            (obj.includes('.jpg') || obj.includes('.jpeg') || obj.includes('.png') || 
                             obj.includes('.gif') || obj.includes('.webp') || obj.includes('data:image'))) {
                            foundImages.push({
                                url: obj,
                                path: path
                            });
                            imageFields.add(path.split('.').pop());
                        }
                    } else if (Array.isArray(obj)) {
                        obj.forEach((item, index) => {
                            findUrls(item, `${path}[${index}]`);
                        });
                    } else if (typeof obj === 'object') {
                        Object.keys(obj).forEach(key => {
                            findUrls(obj[key], path ? `${path}.${key}` : key);
                        });
                    }
                }
                
                findUrls(data);
                
                // Í≤∞Í≥º ÌëúÏãú
                let html = '<h3>Ïù¥ÎØ∏ÏßÄ ÌïÑÎìú Î∂ÑÏÑù:</h3>';
                html += `<p class="success">‚úÖ Î∞úÍ≤¨Îêú Ïù¥ÎØ∏ÏßÄ: ${foundImages.length}Í∞ú</p>`;
                
                if (foundImages.length > 0) {
                    html += '<h4>Ïù¥ÎØ∏ÏßÄÍ∞Ä Ï†ÄÏû•Îêú ÌïÑÎìúÎì§:</h4><ul>';
                    imageFields.forEach(field => {
                        html += `<li class="info">${field}</li>`;
                    });
                    html += '</ul>';
                    
                    html += '<h4>Ïù¥ÎØ∏ÏßÄ Í≤ΩÎ°ú ÏòàÏãú (Ï≤òÏùå 5Í∞ú):</h4><ul>';
                    foundImages.slice(0, 5).forEach(img => {
                        html += `<li><span class="highlight">${img.path}</span><br>`;
                        html += `<small>${img.url.substring(0, 100)}...</small></li>`;
                    });
                    html += '</ul>';
                } else {
                    problems.push('Ïù¥ÎØ∏ÏßÄ URLÏù¥ Ï†ÑÌòÄ Î∞úÍ≤¨ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                }
                
                output.innerHTML = html;
                
                // Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞
                if (foundImages.length > 0) {
                    let imageHtml = '<h3>Î∞úÍ≤¨Îêú Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞:</h3>';
                    imageHtml += '<div class="image-grid">';
                    
                    foundImages.slice(0, 12).forEach((img, idx) => {
                        imageHtml += `
                            <div class="image-item">
                                <img src="${img.url}" alt="Image ${idx + 1}" onerror="this.src='data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"200\" height=\"150\"><rect width=\"200\" height=\"150\" fill=\"%23333\"/><text x=\"50%\" y=\"50%\" text-anchor=\"middle\" dy=\".3em\" fill=\"%23999\">Î°úÎìú Ïã§Ìå®</text></svg>'">
                                <div class="image-info">
                                    <strong>Í≤ΩÎ°ú:</strong> ${img.path}<br>
                                    <strong>URL:</strong> ${img.url.substring(0, 50)}...
                                </div>
                            </div>
                        `;
                    });
                    
                    imageHtml += '</div>';
                    imagesDiv.innerHTML = imageHtml;
                }
                
                // ÏßÑÎã® Í≤∞Í≥º
                let diagnosisHtml = '<h3>ÏßÑÎã® Í≤∞Í≥º:</h3>';
                
                if (foundImages.length === 0) {
                    diagnosisHtml += '<p class="error">‚ùå Ïù¥ÎØ∏ÏßÄÍ∞Ä Ï†ÑÌòÄ Î∞úÍ≤¨ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.</p>';
                    diagnosisHtml += '<p>Í∞ÄÎä•Ìïú ÏõêÏù∏:</p><ul>';
                    diagnosisHtml += '<li>Ïä§ÌÜ†Î¶¨Î≥¥ÎìúÏóê Ïù¥ÎØ∏ÏßÄÍ∞Ä Ï∂îÍ∞ÄÎêòÏßÄ ÏïäÏïòÏùå</li>';
                    diagnosisHtml += '<li>Ïù¥ÎØ∏ÏßÄ URL ÌïÑÎìúÎ™ÖÏù¥ ÏòàÏÉÅÍ≥º Îã§Î¶Ñ</li>';
                    diagnosisHtml += '<li>Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•Ïù¥ Ï†úÎåÄÎ°ú ÎêòÏßÄ ÏïäÏùå</li>';
                    diagnosisHtml += '</ul>';
                } else {
                    diagnosisHtml += `<p class="success">‚úÖ ${foundImages.length}Í∞úÏùò Ïù¥ÎØ∏ÏßÄÎ•º Î∞úÍ≤¨ÌñàÏäµÎãàÎã§.</p>`;
                    diagnosisHtml += '<p>ÎØ∏ÎîîÏñ¥ Í∞§Îü¨Î¶¨Í∞Ä Ï∞æÏïÑÏïº Ìï† ÌïÑÎìú:</p><ul>';
                    
                    // Ïã§Ï†ú ÌïÑÎìú Í≤ΩÎ°ú Î∂ÑÏÑù
                    const fieldPaths = {};
                    foundImages.forEach(img => {
                        const parts = img.path.split('.');
                        const key = parts.slice(-2).join('.');
                        fieldPaths[key] = (fieldPaths[key] || 0) + 1;
                    });
                    
                    Object.entries(fieldPaths).forEach(([path, count]) => {
                        diagnosisHtml += `<li class="warning">${path} (${count}Í∞ú)</li>`;
                    });
                    diagnosisHtml += '</ul>';
                    
                    diagnosisHtml += '<p class="info">üí° ÎØ∏ÎîîÏñ¥ Í∞§Îü¨Î¶¨ ÏΩîÎìúÎ•º Ïù¥ ÌïÑÎìúÎì§ÏùÑ ÏùΩÎèÑÎ°ù ÏàòÏ†ïÌï¥Ïïº Ìï©ÎãàÎã§.</p>';
                }
                
                diagnosisDiv.innerHTML = diagnosisHtml;
                
            } catch (e) {
                output.innerHTML = `<p class="error">‚ùå Ïò§Î•ò: ${e.message}</p>`;
                console.error(e);
            }
        }
        
        // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú ÏûêÎèô Ïã§Ìñâ
        window.addEventListener('DOMContentLoaded', () => {
            checkLocalStorageKeys();
            checkStoryboardData();
            findAllImages();
        });
    </script>
</body>
</html>