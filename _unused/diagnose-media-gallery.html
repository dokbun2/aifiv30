<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¯¸ë””ì–´ ê°¤ëŸ¬ë¦¬ ì§„ë‹¨ ë„êµ¬</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #007AFF;
            border-bottom: 2px solid #007AFF;
            padding-bottom: 10px;
        }
        
        .section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .section h2 {
            color: #40d372;
            margin-top: 0;
        }
        
        pre {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 12px;
            line-height: 1.5;
        }
        
        .success {
            color: #40d372;
        }
        
        .error {
            color: #ff453a;
        }
        
        .warning {
            color: #ffd60a;
        }
        
        .info {
            color: #007AFF;
        }
        
        button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            background: #0051D5;
        }
        
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .image-item {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
        }
        
        .image-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .image-info {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.4;
        }
        
        .highlight {
            background: rgba(255, 255, 0, 0.2);
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ë¯¸ë””ì–´ ê°¤ëŸ¬ë¦¬ ì§„ë‹¨ ë„êµ¬</h1>
        
        <div class="section">
            <h2>1. localStorage í‚¤ ê²€ì‚¬</h2>
            <button onclick="checkLocalStorageKeys()">localStorage í‚¤ í™•ì¸</button>
            <button onclick="checkStoryboardData()">storyboardData êµ¬ì¡° í™•ì¸</button>
            <button onclick="findAllImages()">ëª¨ë“  ì´ë¯¸ì§€ ì°¾ê¸°</button>
            <div id="localStorage-keys"></div>
        </div>
        
        <div class="section">
            <h2>2. ìŠ¤í† ë¦¬ë³´ë“œ ë°ì´í„° êµ¬ì¡° ë¶„ì„</h2>
            <div id="data-structure"></div>
        </div>
        
        <div class="section">
            <h2>3. ì´ë¯¸ì§€ í•„ë“œ ë§¤í•‘</h2>
            <div id="image-mapping"></div>
        </div>
        
        <div class="section">
            <h2>4. ë°œê²¬ëœ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°</h2>
            <div id="found-images"></div>
        </div>
        
        <div class="section">
            <h2>5. ë¬¸ì œ ì§„ë‹¨ ê²°ê³¼</h2>
            <div id="diagnosis"></div>
        </div>
    </div>
    
    <script>
        // localStorage í‚¤ í™•ì¸
        function checkLocalStorageKeys() {
            const output = document.getElementById('localStorage-keys');
            let html = '<h3>ë°œê²¬ëœ localStorage í‚¤:</h3><ul>';
            
            const keys = Object.keys(localStorage);
            keys.forEach(key => {
                const size = localStorage.getItem(key).length;
                const sizeKB = (size / 1024).toFixed(2);
                
                if (key.toLowerCase().includes('storyboard') || 
                    key.toLowerCase().includes('breakdown') || 
                    key.toLowerCase().includes('shot')) {
                    html += `<li class="success"><strong>${key}</strong> (${sizeKB} KB)</li>`;
                } else {
                    html += `<li>${key} (${sizeKB} KB)</li>`;
                }
            });
            
            html += '</ul>';
            output.innerHTML = html;
        }
        
        // storyboardData êµ¬ì¡° í™•ì¸
        function checkStoryboardData() {
            const output = document.getElementById('data-structure');
            const storyboardData = localStorage.getItem('storyboardData');
            
            if (!storyboardData) {
                output.innerHTML = '<p class="error">âŒ storyboardDataê°€ localStorageì— ì—†ìŠµë‹ˆë‹¤!</p>';
                return;
            }
            
            try {
                const data = JSON.parse(storyboardData);
                let html = '<h3>storyboardData êµ¬ì¡°:</h3>';
                
                // ë°ì´í„° êµ¬ì¡° ë¶„ì„
                html += '<h4>ìµœìƒìœ„ í‚¤:</h4><ul>';
                Object.keys(data).forEach(key => {
                    html += `<li class="info">${key}`;
                    
                    if (key === 'breakdown_data' && data[key]) {
                        html += '<ul>';
                        Object.keys(data[key]).forEach(subKey => {
                            if (subKey === 'shots' && Array.isArray(data[key][subKey])) {
                                html += `<li class="success"><strong>${subKey}</strong> (ë°°ì—´, ${data[key][subKey].length}ê°œ í•­ëª©)</li>`;
                                
                                // ì²« ë²ˆì§¸ ìƒ·ì˜ êµ¬ì¡° í‘œì‹œ
                                if (data[key][subKey].length > 0) {
                                    const firstShot = data[key][subKey][0];
                                    html += '<li>ì²« ë²ˆì§¸ ìƒ·ì˜ í‚¤ë“¤:<ul>';
                                    Object.keys(firstShot).forEach(shotKey => {
                                        const value = firstShot[shotKey];
                                        const type = Array.isArray(value) ? 'array' : typeof value;
                                        
                                        if (shotKey.includes('image') || shotKey.includes('video')) {
                                            html += `<li class="warning"><strong>${shotKey}</strong> (${type})</li>`;
                                        } else {
                                            html += `<li>${shotKey} (${type})</li>`;
                                        }
                                    });
                                    html += '</ul></li>';
                                }
                            } else {
                                html += `<li>${subKey}</li>`;
                            }
                        });
                        html += '</ul>';
                    }
                    
                    html += '</li>';
                });
                html += '</ul>';
                
                // ì „ì²´ ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ í‘œì‹œ
                html += '<h4>ì „ì²´ ë°ì´í„° (ì¶•ì•½):</h4>';
                html += `<pre>${JSON.stringify(data, null, 2).substring(0, 2000)}...</pre>`;
                
                output.innerHTML = html;
            } catch (e) {
                output.innerHTML = `<p class="error">âŒ íŒŒì‹± ì˜¤ë¥˜: ${e.message}</p>`;
            }
        }
        
        // ëª¨ë“  ì´ë¯¸ì§€ ì°¾ê¸°
        function findAllImages() {
            const output = document.getElementById('image-mapping');
            const imagesDiv = document.getElementById('found-images');
            const diagnosisDiv = document.getElementById('diagnosis');
            
            const storyboardData = localStorage.getItem('storyboardData');
            
            if (!storyboardData) {
                output.innerHTML = '<p class="error">âŒ storyboardDataê°€ ì—†ìŠµë‹ˆë‹¤!</p>';
                return;
            }
            
            try {
                const data = JSON.parse(storyboardData);
                let foundImages = [];
                let imageFields = new Set();
                let problems = [];
                
                // ì¬ê·€ì ìœ¼ë¡œ ëª¨ë“  URL ì°¾ê¸°
                function findUrls(obj, path = '') {
                    if (!obj) return;
                    
                    if (typeof obj === 'string') {
                        // URL íŒ¨í„´ ì²´í¬
                        if ((obj.includes('http://') || obj.includes('https://') || obj.includes('data:image')) && 
                            (obj.includes('.jpg') || obj.includes('.jpeg') || obj.includes('.png') || 
                             obj.includes('.gif') || obj.includes('.webp') || obj.includes('data:image'))) {
                            foundImages.push({
                                url: obj,
                                path: path
                            });
                            imageFields.add(path.split('.').pop());
                        }
                    } else if (Array.isArray(obj)) {
                        obj.forEach((item, index) => {
                            findUrls(item, `${path}[${index}]`);
                        });
                    } else if (typeof obj === 'object') {
                        Object.keys(obj).forEach(key => {
                            findUrls(obj[key], path ? `${path}.${key}` : key);
                        });
                    }
                }
                
                findUrls(data);
                
                // ê²°ê³¼ í‘œì‹œ
                let html = '<h3>ì´ë¯¸ì§€ í•„ë“œ ë¶„ì„:</h3>';
                html += `<p class="success">âœ… ë°œê²¬ëœ ì´ë¯¸ì§€: ${foundImages.length}ê°œ</p>`;
                
                if (foundImages.length > 0) {
                    html += '<h4>ì´ë¯¸ì§€ê°€ ì €ì¥ëœ í•„ë“œë“¤:</h4><ul>';
                    imageFields.forEach(field => {
                        html += `<li class="info">${field}</li>`;
                    });
                    html += '</ul>';
                    
                    html += '<h4>ì´ë¯¸ì§€ ê²½ë¡œ ì˜ˆì‹œ (ì²˜ìŒ 5ê°œ):</h4><ul>';
                    foundImages.slice(0, 5).forEach(img => {
                        html += `<li><span class="highlight">${img.path}</span><br>`;
                        html += `<small>${img.url.substring(0, 100)}...</small></li>`;
                    });
                    html += '</ul>';
                } else {
                    problems.push('ì´ë¯¸ì§€ URLì´ ì „í˜€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }
                
                output.innerHTML = html;
                
                // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
                if (foundImages.length > 0) {
                    let imageHtml = '<h3>ë°œê²¬ëœ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°:</h3>';
                    imageHtml += '<div class="image-grid">';
                    
                    foundImages.slice(0, 12).forEach((img, idx) => {
                        imageHtml += `
                            <div class="image-item">
                                <img src="${img.url}" alt="Image ${idx + 1}" onerror="this.src='data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"200\" height=\"150\"><rect width=\"200\" height=\"150\" fill=\"%23333\"/><text x=\"50%\" y=\"50%\" text-anchor=\"middle\" dy=\".3em\" fill=\"%23999\">ë¡œë“œ ì‹¤íŒ¨</text></svg>'">
                                <div class="image-info">
                                    <strong>ê²½ë¡œ:</strong> ${img.path}<br>
                                    <strong>URL:</strong> ${img.url.substring(0, 50)}...
                                </div>
                            </div>
                        `;
                    });
                    
                    imageHtml += '</div>';
                    imagesDiv.innerHTML = imageHtml;
                }
                
                // ì§„ë‹¨ ê²°ê³¼
                let diagnosisHtml = '<h3>ì§„ë‹¨ ê²°ê³¼:</h3>';
                
                if (foundImages.length === 0) {
                    diagnosisHtml += '<p class="error">âŒ ì´ë¯¸ì§€ê°€ ì „í˜€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>';
                    diagnosisHtml += '<p>ê°€ëŠ¥í•œ ì›ì¸:</p><ul>';
                    diagnosisHtml += '<li>ìŠ¤í† ë¦¬ë³´ë“œì— ì´ë¯¸ì§€ê°€ ì¶”ê°€ë˜ì§€ ì•Šì•˜ìŒ</li>';
                    diagnosisHtml += '<li>ì´ë¯¸ì§€ URL í•„ë“œëª…ì´ ì˜ˆìƒê³¼ ë‹¤ë¦„</li>';
                    diagnosisHtml += '<li>ë°ì´í„° ì €ì¥ì´ ì œëŒ€ë¡œ ë˜ì§€ ì•ŠìŒ</li>';
                    diagnosisHtml += '</ul>';
                } else {
                    diagnosisHtml += `<p class="success">âœ… ${foundImages.length}ê°œì˜ ì´ë¯¸ì§€ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.</p>`;
                    diagnosisHtml += '<p>ë¯¸ë””ì–´ ê°¤ëŸ¬ë¦¬ê°€ ì°¾ì•„ì•¼ í•  í•„ë“œ:</p><ul>';
                    
                    // ì‹¤ì œ í•„ë“œ ê²½ë¡œ ë¶„ì„
                    const fieldPaths = {};
                    foundImages.forEach(img => {
                        const parts = img.path.split('.');
                        const key = parts.slice(-2).join('.');
                        fieldPaths[key] = (fieldPaths[key] || 0) + 1;
                    });
                    
                    Object.entries(fieldPaths).forEach(([path, count]) => {
                        diagnosisHtml += `<li class="warning">${path} (${count}ê°œ)</li>`;
                    });
                    diagnosisHtml += '</ul>';
                    
                    diagnosisHtml += '<p class="info">ğŸ’¡ ë¯¸ë””ì–´ ê°¤ëŸ¬ë¦¬ ì½”ë“œë¥¼ ì´ í•„ë“œë“¤ì„ ì½ë„ë¡ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.</p>';
                }
                
                diagnosisDiv.innerHTML = diagnosisHtml;
                
            } catch (e) {
                output.innerHTML = `<p class="error">âŒ ì˜¤ë¥˜: ${e.message}</p>`;
                console.error(e);
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('DOMContentLoaded', () => {
            checkLocalStorageKeys();
            checkStoryboardData();
            findAllImages();
        });
    </script>
</body>
</html>