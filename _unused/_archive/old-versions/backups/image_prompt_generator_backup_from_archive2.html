<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸°</title>
    
    <!-- CSS íŒŒì¼ ë§í¬ -->
    <link rel="stylesheet" href="design-system.css">
    <link rel="stylesheet" href="concept-art-styles-modern.css">
    <link rel="stylesheet" href="concept-art-styles-unified.css">
    
    <!-- SEO -->
    <meta name="description" content="AI ì´ë¯¸ì§€ ìƒì„±ì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ ì œì‘ ë„êµ¬">
    <meta name="keywords" content="AI ì´ë¯¸ì§€ìƒì„±, í”„ë¡¬í”„íŠ¸, Midjourney, DALL-E, Stable Diffusion">
    
    <!-- íŒŒë¹„ì½˜ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ–¼ï¸</text></svg>">
    
    <style>
        /* í˜ì´ì§€ íŠ¹í™” ìŠ¤íƒ€ì¼ */
        .main-container {
            max-width: 1800px;
            margin: 0 auto;
            padding: var(--space-lg);
            padding-top: 20px;
            position: relative;
            z-index: 1;
        }
        
        /* PCì—ì„œ ì ì ˆí•œ ì»¨í…ì¸  ë„ˆë¹„ ìœ ì§€ */
        @media (min-width: 1200px) {
            .main-container {
                padding-left: 3%;
                padding-right: 3%;
            }
        }

        .section {
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            margin-bottom: var(--space-md);
            position: relative;
            overflow: hidden;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-gradient);
            opacity: 0.8;
        }

        .section-header {
            margin-bottom: var(--space-sm);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .section-header-left {
            flex: 1;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-subtitle {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 400;
        }

        /* ì…ë ¥ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .input-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }
        
        /* í° í™”ë©´ì—ì„œ ìµœì  ë¹„ìœ¨ */
        @media (min-width: 1400px) {
            .input-area {
                grid-template-columns: 1fr 1fr;
                gap: var(--space-lg);
            }
        }
        
        /* ì´ˆëŒ€í˜• í™”ë©´ì—ì„œ ë” ë„“ì€ ë ˆì´ì•„ì›ƒ */
        @media (min-width: 1600px) {
            .input-area {
                grid-template-columns: 1.2fr 0.8fr;
                gap: var(--space-xl);
            }
        }

        .input-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            padding: var(--space-sm);
            transition: all var(--transition-base);
        }

        .input-section:hover {
            border-color: rgba(168, 85, 247, 0.5);
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.1);
        }

        .input-section h3 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: var(--space-sm);
            color: var(--text-primary);
            word-break: keep-all;
            white-space: normal;
        }

        .text-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            padding: var(--space-sm);
            color: var(--text-primary);
            font-family: 'Paperlogy', sans-serif;
            font-size: 0.85rem;
            resize: vertical;
            min-height: 150px;
            transition: all var(--transition-base);
        }

        .text-input:focus {
            outline: none;
            border-color: var(--accent-purple);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.2);
        }

        /* íŒŒì¼ ì—…ë¡œë“œ ìŠ¤íƒ€ì¼ */
        .file-upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-sm);
            padding: var(--space-md);
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-base);
            min-height: 150px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .file-upload-area:hover {
            border-color: var(--accent-purple);
            background: rgba(168, 85, 247, 0.05);
        }

        .file-upload-area.drag-over {
            border-color: var(--accent-green);
            background: rgba(16, 185, 129, 0.1);
        }

        .upload-icon {
            font-size: 2rem;
            margin-bottom: var(--space-sm);
            opacity: 0.7;
        }

        .upload-text {
            color: var(--text-secondary);
            margin-bottom: var(--space-xs);
            font-size: 0.85rem;
        }

        .upload-hint {
            font-size: 0.75rem;
            color: var(--text-tertiary);
        }

        .file-input {
            display: none;
        }

        /* ì´ë¯¸ì§€ í”„ë¦¬ë·° */
        .image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: var(--radius-sm);
            margin-top: var(--space-sm);
        }

        .remove-image-btn {
            position: absolute;
            top: var(--space-xs);
            right: var(--space-xs);
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: var(--radius-full);
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all var(--transition-base);
        }

        .remove-image-btn:hover {
            background: rgba(239, 68, 68, 1);
            transform: scale(1.1);
        }

        /* ë²„íŠ¼ ê·¸ë£¹ */
        .button-group {
            display: flex;
            gap: var(--space-sm);
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .btn {
            padding: 6px 16px;
            border: none;
            border-radius: var(--radius-full);
            font-family: 'Paperlogy', sans-serif;
            font-weight: 500;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all var(--transition-base);
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(168, 85, 247, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .btn-export {
            background: var(--accent-gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }

        /* ìƒì„±ëœ í”„ë¡¬í”„íŠ¸ ì˜ì—­ */
        .output-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            padding: var(--space-md);
            margin-top: var(--space-md);
            display: none;
        }

        .output-section.active {
            display: block;
        }

        .output-text {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            padding: var(--space-sm);
            color: var(--text-primary);
            font-family: 'Paperlogy', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .copy-btn {
            margin-top: var(--space-sm);
            background: var(--secondary-gradient);
            color: white;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        /* í”„ë¡¬í”„íŠ¸ ì…ë ¥ ì˜ì—­ */
        .prompt-preview-section {
            margin-top: var(--space-lg);
            margin-bottom: var(--space-md);
        }
        
        /* í”„ë¡¬í”„íŠ¸ ì¹´ë“œ ì„¹ì…˜ ì „ì²´ ë„ˆë¹„ ë³´ì¥ */
        #prompt-cards-section {
            width: 100%;
        }
        
        #prompt-cards-grid {
            width: 100%;
        }

        .preview-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-sm);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .prompt-preview {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            padding: var(--space-md);
            min-height: 80px;
            font-family: 'Paperlogy', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            color: var(--text-primary);
            transition: all var(--transition-base);
        }

        .prompt-preview:hover {
            border-color: rgba(168, 85, 247, 0.3);
            background: rgba(255, 255, 255, 0.05);
        }

        .preview-placeholder {
            color: var(--text-tertiary);
            font-style: italic;
            margin: 0;
        }

        .prompt-preview.has-content {
            color: var(--text-primary);
            font-style: normal;
        }

        /* í”„ë¡¬í”„íŠ¸ ì…ë ¥ ê°€ëŠ¥ ìŠ¤íƒ€ì¼ */
        .prompt-preview[contenteditable="true"] {
            cursor: text;
            outline: none;
            min-height: 100px;
        }
        .prompt-preview:focus {
            border-color: rgba(168, 85, 247, 0.5);
            background: rgba(255, 255, 255, 0.06);
        }

        /* êµ¬ì¡° í¸ì§‘ê¸° íƒ­ ìŠ¤íƒ€ì¼ */
        .structure-tabs {
            margin-bottom: var(--space-md);
        }
        
        .structure-tab-buttons { 
            display: flex; 
            gap: var(--space-xs); 
            margin-bottom: var(--space-xs); 
        }
        
        .structure-tab-button {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-base);
        }
        
        .structure-tab-button:hover { 
            border-color: rgba(168, 85, 247, 0.35); 
            background: rgba(168, 85, 247, 0.05);
        }
        
        .structure-tab-button.active {
            background: rgba(168, 85, 247, 0.15);
            border-color: rgba(168, 85, 247, 0.35);
            color: white;
        }
        
        /* êµ¬ì¡° í¸ì§‘ê¸° ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .structure-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            padding: var(--space-md);
            margin-bottom: var(--space-sm);
        }
        
        .structure-section-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--accent-purple);
            margin-bottom: var(--space-sm);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* ìºë¦­í„° ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        .character-container {
            width: 100% !important;
            display: flex;
            flex-direction: column;
            max-width: none !important;
        }
        
        /* ìºë¦­í„° í•˜ìœ„ íƒ­ ìŠ¤íƒ€ì¼ */
        .character-sub-tabs {
            margin-bottom: var(--space-md);
            width: 100%;
        }
        
        .sub-tab-buttons {
            display: flex;
            gap: var(--space-xs);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            padding-bottom: var(--space-xs);
            width: 100%;
        }
        
        .sub-tab-button {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 8px 20px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-base);
            position: relative;
        }
        
        .sub-tab-button:hover {
            color: var(--text-primary);
        }
        
        .sub-tab-button.active {
            color: var(--accent-purple);
        }
        
        .sub-tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent-purple);
        }
        
        /* í•˜ìœ„ íƒ­ ì»¨í…ì¸  ìŠ¤íƒ€ì¼ */
        .sub-tab-contents {
            min-height: 400px;
            width: 100%;
        }
        
        .sub-tab-content {
            display: none;
            width: 100%;
            position: relative;
        }
        
        .sub-tab-content.active {
            display: block;
        }
        
        /* ìºë¦­í„° í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .character-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .character-row {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all var(--transition-base);
        }
        
        .character-row:hover {
            background: rgba(255, 255, 255, 0.02);
        }
        
        .character-row td {
            padding: var(--space-sm) var(--space-md);
            vertical-align: middle;
        }
        
        .style-column {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            width: 150px;
            text-align: center;
            font-size: 0.85rem;
            white-space: nowrap;
            padding: var(--space-sm) var(--space-md);
        }
        
        .item-number {
            color: var(--text-tertiary);
            font-size: 0.85rem;
            min-width: 40px;
            font-weight: 500;
            text-align: center;
        }
        
        .item-key {
            color: var(--accent-purple);
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 150px;
        }
        
        .item-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            padding: 8px 12px;
            color: var(--text-primary);
            font-family: 'Paperlogy', sans-serif;
            font-size: 0.85rem;
            transition: all var(--transition-base);
        }
        
        .item-input.change-request {
            background-color: rgba(255, 255, 255, 0.03);
        }
        
        .item-input.change-applied {
            background-color: rgba(240, 248, 255, 0.05);
        }
        
        /* ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        .dropdown-container {
            margin-bottom: var(--space-md);
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-md);
            overflow: hidden;
            transition: all var(--transition-base);
            position: relative;
        }
        
        .dropdown-container.active {
            overflow: visible;
        }
        
        .dropdown-container:hover {
            border-color: rgba(168, 85, 247, 0.3);
            box-shadow: 0 4px 20px rgba(168, 85, 247, 0.1);
        }
        
        .dropdown-container.active {
            border-color: var(--accent-purple);
            box-shadow: 0 6px 24px rgba(168, 85, 247, 0.2);
        }
        
        .dropdown-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            cursor: pointer;
            transition: all var(--transition-base);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .dropdown-header:hover {
            background: rgba(168, 85, 247, 0.1);
            border-bottom-color: var(--accent-purple);
        }
        
        .dropdown-title {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .dropdown-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--accent-purple);
            color: white;
            border-radius: var(--radius-full);
            font-size: 0.85rem;
            font-weight: 700;
            transition: all var(--transition-base);
        }
        
        .dropdown-container:hover .dropdown-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: scale(1.1);
        }
        
        .dropdown-arrow {
            transition: transform var(--transition-base);
            font-size: 1.2rem;
            color: var(--accent-purple);
        }
        
        .dropdown-container:hover .dropdown-arrow {
            color: var(--text-primary);
        }
        
        .dropdown-english-label {
            display: inline-block;
            background: var(--accent-green);
            color: white;
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: var(--space-xs);
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .dropdown-container:hover .dropdown-english-label {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }
        
        /* Select-Input í•˜ì´ë¸Œë¦¬ë“œ ìŠ¤íƒ€ì¼ */
        .select-input-wrapper {
            position: relative;
            width: 100%;
        }
        
        .dropdown-field-input.with-select {
            padding-right: 35px;
        }
        
        .dropdown-toggle-btn {
            position: absolute;
            right: 1px;
            top: 1px;
            bottom: 1px;
            width: 30px;
            background: var(--accent-purple);
            border: none;
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-base);
        }
        
        .dropdown-toggle-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .dropdown-icon {
            font-size: 0.8rem;
            transition: transform var(--transition-base);
        }
        
        .dropdown-toggle-btn.active .dropdown-icon {
            transform: rotate(180deg);
        }
        
        .style-options-dropdown {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            background: rgba(30, 30, 35, 0.98);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;
            z-index: 10000;
            max-height: 300px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            pointer-events: auto;
        }
        
        .style-options-search {
            padding: var(--space-sm);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
        }
        
        .style-options-search input {
            width: 100%;
            padding: 6px 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 0.8rem;
        }
        
        .style-options-list {
            overflow-y: auto;
            max-height: 250px;
            background: rgba(20, 20, 25, 0.6);
        }
        
        .style-option {
            padding: 8px 12px;
            cursor: pointer;
            transition: all var(--transition-base);
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .style-option:hover {
            background: rgba(168, 85, 247, 0.1);
            color: var(--text-primary);
            padding-left: 16px;
        }
        
        .style-option.selected {
            background: rgba(168, 85, 247, 0.2);
            color: var(--accent-purple);
            font-weight: 600;
        }
        
        .style-option.focused {
            background: rgba(168, 85, 247, 0.15);
            color: var(--text-primary);
            outline: 2px solid var(--accent-purple);
            outline-offset: -2px;
        }
        
        .style-option.hidden {
            display: none;
        }
        
        .dropdown-container.active .dropdown-arrow {
            transform: rotate(180deg);
        }
        
        .dropdown-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: rgba(255, 255, 255, 0.02);
            position: relative;
        }
        
        .dropdown-container.active .dropdown-content {
            max-height: 500px;
            overflow: visible;
        }
        
        .dropdown-fields {
            padding: var(--space-md);
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
            position: relative;
        }
        
        .dropdown-field {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
            position: relative;
        }
        
        
        .field-action-buttons {
            display: flex;
            gap: 6px;
            flex-shrink: 0;
        }
        
        .btn-field-action {
            padding: 4px 8px;
            font-size: 0.7rem;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-base);
            font-weight: 500;
            white-space: nowrap;
        }
        
        .btn-save {
            background: var(--accent-green);
            color: white;
        }
        
        .btn-save:hover {
            background: #059669;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }
        
        .btn-ai-save {
            background: var(--accent-purple);
            color: white;
        }
        
        .btn-ai-save:hover {
            background: #9333EA;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(168, 85, 247, 0.3);
        }
        
        .dropdown-field-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--space-xs);
            display: block;
            line-height: 20px;
            min-height: 20px;
        }
        
        .dropdown-field-label-with-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-xs);
            height: 20px; /* ë¼ë²¨ ì˜ì—­ ë†’ì´ ê³ ì • */
        }
        
        .dropdown-field-label-with-buttons .dropdown-field-label {
            margin-bottom: 0;
        }
        
        .dropdown-field-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            padding: 10px 14px;
            color: var(--text-primary);
            font-family: 'Paperlogy', sans-serif;
            font-size: 0.85rem;
            transition: all var(--transition-base);
        }
        
        .dropdown-field-input:focus {
            outline: none;
            border-color: var(--accent-purple);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }
        
        /* ëª¨ë°”ì¼ ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        @media (max-width: 767px) {
            .dropdown-fields {
                grid-template-columns: 1fr;
                gap: var(--space-sm);
            }
            
            .dropdown-title {
                font-size: 0.85rem;
            }
            
            .dropdown-number {
                width: 24px;
                height: 24px;
                font-size: 0.75rem;
            }
            
            .dropdown-field-label-with-buttons {
                flex-wrap: wrap;
                gap: var(--space-xs);
            }
            
            .dropdown-field-label-with-buttons .field-action-buttons {
                width: 100%;
                order: 2;
                margin-top: var(--space-xs);
            }
            
            .btn-field-action {
                flex: 1;
                padding: 4px 6px;
                font-size: 0.65rem;
            }
        }
        
        .item-input:focus {
            outline: none;
            border-color: var(--accent-purple);
            background: rgba(255, 255, 255, 0.08);
        }
        

        /* êµ¬ì¡°ë³„ ì¹´ë“œ ì„¹ì…˜ */
        .prompt-cards-section {
            margin-top: var(--space-md);
            margin-bottom: var(--space-md);
            margin-left: calc(-1 * var(--space-md));
            margin-right: calc(-1 * var(--space-md));
            padding: var(--space-md);
            background: rgba(0, 0, 0, 0.2);
        }

        .cards-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .cards-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            word-break: keep-all;
            white-space: normal;
        }

        .btn-import {
            background: var(--secondary-gradient);
            color: white;
            font-size: 0.8rem;
            padding: 6px 14px;
        }

        .btn-import:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .prompt-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-sm);
        }
        
        /* ìºë¦­í„° íƒ­ì—ì„œ prompt-cards-grid ì˜¤ë²„ë¼ì´ë“œ */
        .prompt-cards-grid:has(.character-container) {
            display: block;
            width: 100%;
        }
        
        /* í° í™”ë©´ì—ì„œ ë” ë§ì€ ì¹´ë“œ í‘œì‹œ */
        @media (min-width: 1600px) {
            .prompt-cards-grid {
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
                gap: var(--space-md);
            }
        }

        .prompt-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-sm);
            padding: var(--space-sm);
            transition: all var(--transition-base);
            position: relative;
        }

        .prompt-card:hover {
            border-color: rgba(168, 85, 247, 0.3);
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-1px);
        }

        .prompt-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-xs);
        }

        .prompt-card-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--accent-purple);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .prompt-card-edit-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.9rem;
            padding: 2px 6px;
            border-radius: var(--radius-sm);
            transition: all var(--transition-base);
        }

        .prompt-card-edit-btn:hover {
            color: var(--accent-purple);
            background: rgba(168, 85, 247, 0.1);
        }

        .prompt-card-content {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.4;
            min-height: 40px;
        }

        .prompt-card-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            padding: var(--space-xs);
            color: var(--text-primary);
            font-family: 'Paperlogy', sans-serif;
            font-size: 0.8rem;
            resize: vertical;
            min-height: 60px;
            display: none;
        }

        .prompt-card.editing .prompt-card-content {
            display: none;
        }

        .prompt-card.editing .prompt-card-input {
            display: block;
        }

        .prompt-card-actions {
            display: none;
            gap: var(--space-xs);
            margin-top: var(--space-xs);
        }

        .prompt-card.editing .prompt-card-actions {
            display: flex;
        }

        .prompt-card-btn {
            padding: 4px 12px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .prompt-card-save {
            background: var(--accent-green);
            color: white;
        }

        .prompt-card-save:hover {
            background: rgba(16, 185, 129, 0.8);
        }

        .prompt-card-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
        }

        .prompt-card-cancel:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
        .toast {
            position: fixed;
            bottom: var(--space-md);
            right: var(--space-md);
            background: rgba(16, 185, 129, 0.9);
            color: white;
            padding: 6px 16px;
            border-radius: var(--radius-full);
            font-weight: 500;
            font-size: 0.85rem;
            opacity: 0;
            transform: translateY(20px);
            transition: all var(--transition-base);
            pointer-events: none;
            z-index: 2000;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* íƒœë¸”ë¦¿ ë””ìì¸ (768px - 1199px) */
        @media (min-width: 768px) and (max-width: 1199px) {
            .main-container {
                padding-left: var(--space-md);
                padding-right: var(--space-md);
            }
        }

        /* ëª¨ë°”ì¼ ë””ìì¸ */
        @media (max-width: 767px) {
            /* ìºë¦­í„° í…Œì´ë¸” ìŠ¤íƒ€ì¼ ì œê±° - ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ëŒ€ì²´ */
            
            .sub-tab-buttons {
                flex-wrap: wrap;
            }
            
            .sub-tab-button {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
            
            .input-area {
                grid-template-columns: 1fr;
                gap: var(--space-sm);
            }

            .button-group {
                justify-content: center;
                gap: 8px;
                flex-wrap: wrap;
            }

            .main-container {
                padding: var(--space-sm);
                padding-top: 70px;
                max-width: 100%;
            }
            
            .section {
                padding: var(--space-sm);
                margin-bottom: var(--space-sm);
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-sm);
            }
            
            .section-header-left {
                width: 100%;
            }
            
            .section-title {
                font-size: 1rem;
                word-break: keep-all;
                white-space: normal;
            }
            
            .section-subtitle {
                font-size: 0.75rem;
                word-break: keep-all;
                white-space: normal;
            }
            
            .btn {
                padding: 6px 12px;
                font-size: 0.8rem;
                white-space: nowrap;
                min-width: auto;
            }
            
            .btn-ai-connect {
                width: 100%;
                justify-content: center;
            }
            
            .text-input {
                min-height: 120px;
                font-size: 0.8rem;
                word-break: break-word;
            }
            
            .file-upload-area {
                min-height: 120px;
                padding: var(--space-sm);
            }
            
            .upload-icon {
                font-size: 1.5rem;
            }
            
            .upload-text {
                font-size: 0.8rem;
                word-break: keep-all;
            }
            
            .upload-hint {
                font-size: 0.7rem;
                word-break: keep-all;
            }
            
            .prompt-preview-section {
                margin-top: var(--space-md);
                margin-bottom: var(--space-sm);
            }
            
            .prompt-preview {
                min-height: 60px;
                padding: var(--space-sm);
                font-size: 0.8rem;
                word-break: break-word;
                white-space: pre-wrap;
            }
            
            .preview-title {
                font-size: 0.85rem;
                word-break: keep-all;
            }
            
            .preview-placeholder {
                word-break: keep-all;
                white-space: normal;
            }
            
            .prompt-cards-grid {
                grid-template-columns: 1fr;
            }
            
            .prompt-card {
                padding: var(--space-xs);
            }
            
            .prompt-card-title {
                font-size: 0.8rem;
                word-break: keep-all;
            }
            
            .prompt-card-content {
                font-size: 0.75rem;
                word-break: break-word;
            }
            
            .cards-title {
                word-break: keep-all;
                white-space: normal;
                font-size: 0.8rem;
            }
            
            .cards-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-xs);
            }
            
            .btn-import {
                width: 100%;
                font-size: 0.8rem;
                padding: 6px 12px;
            }
        }
        
        /* ì´ˆì†Œí˜• ëª¨ë°”ì¼ (max-width: 380px) */
        @media (max-width: 380px) {
            .button-group {
                flex-direction: column;
                width: 100%;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body class="dark-theme">
    <!-- Gradient Mesh Background -->
    <div class="gradient-mesh-bg"></div>
    
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <a href="index.html" class="home-btn">ğŸ  í™ˆ</a>
                <h2 class="header-title" style="font-size: 1.1rem;">ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸°</h2>
            </div>
            <div class="header-right">
                <div class="header-buttons">
                    <a href="storyboard/index.html" class="header-btn">ìŠ¤í† ë¦¬ë³´ë“œ</a>
                    <a href="your_title_storyboard_v9.4_c.html" class="header-btn">ì»¨ì…‰ì•„íŠ¸</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- ìš”ì²­ì‚¬í•­ ì…ë ¥ ì„¹ì…˜ -->
        <div class="section">
            <div class="section-header">
                <div class="section-header-left">
                    <h2 class="section-title">ìš”ì²­ì‚¬í•­ ì…ë ¥</h2>
                </div>
                <button class="btn btn-primary btn-ai-connect" id="ai-connect-btn">
                    ğŸ¤– AI ì—°ë™
                </button>
            </div>

            <div class="input-area">
                <!-- í…ìŠ¤íŠ¸ ì…ë ¥ ì˜ì—­ -->
                <div class="input-section">
                    <h3>í…ìŠ¤íŠ¸ ì…ë ¥ì°½</h3>
                    <textarea 
                        id="text-input" 
                        class="text-input" 
                        placeholder="ìƒì„±í•˜ê³  ì‹¶ì€ ì´ë¯¸ì§€ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”..."
                    ></textarea>
                </div>

                <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜ì—­ -->
                <div class="input-section">
                    <h3>íŒŒì¼ ì—…ë¡œë“œ</h3>
                    <div class="file-upload-area" id="file-upload-area">
                        <input type="file" id="file-input" class="file-input" accept=".jpg,.jpeg,.png,.gif" />
                        <div class="upload-icon">ğŸ“¸</div>
                        <div class="upload-text">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</div>
                        <div class="upload-hint">JPG, PNG, GIF í˜•ì‹ ì§€ì› (ìµœëŒ€ 10MB)</div>
                    </div>
                </div>
            </div>

            <!-- í”„ë¡¬í”„íŠ¸ ì…ë ¥ ì˜ì—­ -->
            <div class="prompt-preview-section">
                <h3 class="preview-title">í”„ë¡¬í”„íŠ¸ ì…ë ¥</h3>
                <div class="prompt-preview" id="prompt-preview" contenteditable="true" spellcheck="false">
                    <p class="preview-placeholder">í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ í”„ë¡¬í”„íŠ¸ê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>
                </div>
            </div>

            <!-- êµ¬ì¡°ë³„ ì¹´ë“œ ì„¹ì…˜ -->
            <div class="prompt-cards-section" id="prompt-cards-section">
                <div class="cards-header">
                    <h3 class="cards-title">ğŸ¯ í”„ë¡¬í”„íŠ¸ êµ¬ì¡° í¸ì§‘ê¸°</h3>
                    <button class="btn btn-import" id="import-prompt-btn" onclick="importPromptFromPreview()">
                        ğŸ“¥ ê°€ì ¸ì˜¤ê¸°
                    </button>
                </div>
                <!-- êµ¬ì¡° í¸ì§‘ê¸° íƒ­ -->
                <div class="structure-tabs">
                    <div class="structure-tab-buttons">
                        <button type="button" class="structure-tab-button active" id="structure-tab-character" onclick="switchStructureTab('character')">ìºë¦­í„°</button>
                        <button type="button" class="structure-tab-button" id="structure-tab-general" onclick="switchStructureTab('general')">ì¼ë°˜ì´ë¯¸ì§€</button>
                    </div>
                </div>
                <div class="prompt-cards-grid" id="prompt-cards-grid">
                    <!-- ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ë²„íŠ¼ ê·¸ë£¹ -->
            <div class="button-group">
                <button class="btn btn-primary" id="generate-prompt-btn">
                    âœ¨ í”„ë¡¬í”„íŠ¸ ìƒì„±
                </button>
            </div>
        </div>

        <!-- ìƒì„±ëœ í”„ë¡¬í”„íŠ¸ ì¶œë ¥ ì„¹ì…˜ -->
        <div class="section output-section" id="output-section">
            <div class="section-header">
                <h2 class="section-title">ìƒì„±ëœ í”„ë¡¬í”„íŠ¸</h2>
            </div>
            <div class="output-text" id="output-text"></div>
            <button class="btn copy-btn" id="copy-prompt-btn">
                ğŸ“‹ í”„ë¡¬í”„íŠ¸ ë³µì‚¬
            </button>
        </div>
    </div>

    <!-- Toast Message -->
    <div id="toast" class="toast"></div>

    <script>
        // ë°ì´í„° ì €ì¥ìš© ê°ì²´
        let promptData = {
            textInput: '',
            imageFile: null,
            imagePreview: null,
            generatedPrompts: [],
            structuredPrompt: {}
        };

        // DOM ìš”ì†Œë“¤
        const textInput = document.getElementById('text-input');
        const fileInput = document.getElementById('file-input');
        const fileUploadArea = document.getElementById('file-upload-area');
        const generateBtn = document.getElementById('generate-prompt-btn');
        const outputSection = document.getElementById('output-section');
        const outputText = document.getElementById('output-text');
        const copyPromptBtn = document.getElementById('copy-prompt-btn');
        const toast = document.getElementById('toast');
        const aiConnectBtn = document.querySelector('.btn-ai-connect');
        const promptPreview = document.getElementById('prompt-preview');
        const promptCardsSection = document.getElementById('prompt-cards-section');
        const promptCardsGrid = document.getElementById('prompt-cards-grid');
        let userEditingPreview = false;
        
        // ë“œë¡­ë‹¤ìš´ í‚¤ë³´ë“œ ë‚´ë¹„ê²Œì´ì…˜ì„ ìœ„í•œ ì „ì—­ ë³€ìˆ˜
        let currentFocusedIndex = -1;
        let activeDropdown = null;

        // íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ í´ë¦­ ì´ë²¤íŠ¸
        fileUploadArea.addEventListener('click', (e) => {
            if (!e.target.classList.contains('remove-image-btn')) {
                fileInput.click();
            }
        });

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.classList.add('drag-over');
        });

        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.classList.remove('drag-over');
        });

        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileSelect(files[0]);
            }
        });

        // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files[0]);
            }
        });

        // íŒŒì¼ ì²˜ë¦¬ í•¨ìˆ˜
        function handleFileSelect(file) {
            // íŒŒì¼ íƒ€ì… ê²€ì¦
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
            if (!validTypes.includes(file.type)) {
                showToast('JPG, PNG, GIF í˜•ì‹ì˜ ì´ë¯¸ì§€ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            // íŒŒì¼ í¬ê¸° ê²€ì¦ (10MB)
            if (file.size > 10 * 1024 * 1024) {
                showToast('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            // íŒŒì¼ ì½ê¸°
            const reader = new FileReader();
            reader.onload = (e) => {
                promptData.imageFile = file;
                promptData.imagePreview = e.target.result;
                displayImagePreview(e.target.result);
                updatePromptPreview();
            };
            reader.readAsDataURL(file);
        }

        // ì´ë¯¸ì§€ í”„ë¦¬ë·° í‘œì‹œ
        function displayImagePreview(src) {
            fileUploadArea.innerHTML = `
                <button class="remove-image-btn" onclick="removeImage()">Ã—</button>
                <img src="${src}" alt="ì—…ë¡œë“œëœ ì´ë¯¸ì§€" class="image-preview">
            `;
        }

        // ì´ë¯¸ì§€ ì œê±°
        function removeImage() {
            promptData.imageFile = null;
            promptData.imagePreview = null;
            fileInput.value = '';
            
            fileUploadArea.innerHTML = `
                <div class="upload-icon">ğŸ“¸</div>
                <div class="upload-text">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</div>
                <div class="upload-hint">JPG, PNG, GIF í˜•ì‹ ì§€ì› (ìµœëŒ€ 10MB)</div>
            `;
            
            updatePromptPreview();
        }

        // í”„ë¡¬í”„íŠ¸ ìƒì„±
        generateBtn.addEventListener('click', () => {
            const text = textInput.value.trim();
            
            if (!text && !promptData.imageFile) {
                showToast('í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            // ê°„ë‹¨í•œ í”„ë¡¬í”„íŠ¸ ìƒì„± ë¡œì§ (ì‹¤ì œë¡œëŠ” AI API ì—°ë™)
            let prompt = '';
            
            if (text) {
                // í…ìŠ¤íŠ¸ ê¸°ë°˜ í”„ë¡¬í”„íŠ¸ í–¥ìƒ
                prompt = enhancePrompt(text);
            }
            
            if (promptData.imageFile) {
                if (prompt) {
                    prompt += '\n\n[ì´ë¯¸ì§€ ì°¸ì¡° í¬í•¨]\n';
                }
                prompt += 'ì—…ë¡œë“œëœ ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ìŠ¤íƒ€ì¼ê³¼ êµ¬ì„±';
            }

            // í”„ë¡¬í”„íŠ¸ ì €ì¥ ë° í‘œì‹œ
            promptData.generatedPrompts.push({
                timestamp: new Date().toISOString(),
                input: text,
                hasImage: !!promptData.imageFile,
                output: prompt
            });

            displayPrompt(prompt);
            saveToLocalStorage();
        });

        // í”„ë¡¬í”„íŠ¸ íŒŒì‹± í•¨ìˆ˜ (ì„¸ë¯¸ì½œë¡  ê¸°ë°˜ê³¼ ì¤„ë°”ê¿ˆ ê¸°ë°˜ ëª¨ë‘ ì§€ì›)
        function parsePrompt(text) {
            const structure = {};
            
            // ì „ì²´ í…ìŠ¤íŠ¸ì—ì„œ ëª¨ë“  íŒŒë¼ë¯¸í„° ì¶”ì¶œ (ê°’ì´ ìˆëŠ” í”Œë˜ê·¸ì™€ ë‹¨ì¼ í”Œë˜ê·¸ ëª¨ë‘)
            const params = [];
            const paramPattern = /--[a-zA-Z0-9_-]+(?:\s+[^\s;\n]+)?/g;
            let match;
            while ((match = paramPattern.exec(text)) !== null) {
                params.push(match[0]);
            }
            
            // íŒŒë¼ë¯¸í„°ë¥¼ í…ìŠ¤íŠ¸ì—ì„œ ì œê±°
            let cleanText = text;
            params.forEach(param => {
                cleanText = cleanText.replace(param, '').replace(/\s{2,}/g, ' ');
            });
            
            // ì¤„ë°”ê¿ˆì´ ìˆìœ¼ë©´ ì¤„ë°”ê¿ˆ ê¸°ë°˜ìœ¼ë¡œ, ì—†ìœ¼ë©´ ì„¸ë¯¸ì½œë¡  ê¸°ë°˜ìœ¼ë¡œ íŒŒì‹±
            let lines;
            if (cleanText.includes('\n')) {
                // ì¤„ë°”ê¿ˆ ê¸°ë°˜ íŒŒì‹±
                lines = cleanText.split('\n').map(line => line.trim()).filter(line => line);
                // ê° ì¤„ì—ì„œ ëì˜ ì„¸ë¯¸ì½œë¡  ì œê±°
                lines = lines.map(line => line.endsWith(';') ? line.slice(0, -1).trim() : line);
            } else {
                // ì„¸ë¯¸ì½œë¡  ê¸°ë°˜ íŒŒì‹±
                lines = cleanText.split(';').map(line => line.trim()).filter(line => line);
            }
            
            lines.forEach(line => {
                const colonIndex = line.indexOf(':');
                if (colonIndex > -1) {
                    const key = line.substring(0, colonIndex).trim();
                    const value = line.substring(colonIndex + 1).trim();
                    if (key.toUpperCase() !== 'PARAMETERS' || params.length === 0) {
                        structure[key] = value;
                    }
                }
            });
            
            // íŒŒë¼ë¯¸í„° ì €ì¥ (ìˆì„ ë•Œë§Œ)
            if (params.length > 0) {
                structure['PARAMETERS'] = params.join(' ');
            }
            
            return structure;
        }

        // í”„ë¡¬í”„íŠ¸ í–¥ìƒ í•¨ìˆ˜
        function enhancePrompt(text) {
            // êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ì¸ì§€ í™•ì¸
            if (text.includes(':') && text.includes(';')) {
                return text; // ì´ë¯¸ êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ëŠ” ê·¸ëŒ€ë¡œ ë°˜í™˜
            }
            
            // ê¸°ë³¸ í–¥ìƒ í‚¤ì›Œë“œ
            const enhancements = {
                quality: 'highly detailed, 4k, professional',
                style: 'cinematic lighting, photorealistic',
                camera: 'rule of thirds composition',
            };

            let enhanced = text;
            
            // í’ˆì§ˆ ê´€ë ¨ í‚¤ì›Œë“œê°€ ì—†ìœ¼ë©´ ì¶”ê°€
            if (!text.toLowerCase().includes('detailed') && !text.toLowerCase().includes('quality')) {
                enhanced += ', ' + enhancements.quality;
            }

            return enhanced;
        }

        // êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
        function structureToText(structure) {
            let text = '';
            const params = structure['PARAMETERS'] || '';
            const keys = Object.keys(structure).filter(key => key !== 'PARAMETERS');
            
            keys.forEach((key, index) => {
                if (structure[key]) { // ê°’ì´ ìˆëŠ” ê²½ìš°ë§Œ ì¶”ê°€
                    text += `${key}: ${structure[key]}`;
                    if (index < keys.length - 1) {
                        text += '; ';
                    }
                }
            });
            
            if (params) {
                text += ` PARAMETERS: ${params}`;
            }
            
            return text;
        }

        // êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ë¥¼ ë³´ê¸° ì¢‹ê²Œ ì¤„ë°”ê¿ˆëœ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
        function structureToMultilineText(structure) {
            const lines = [];
            const params = structure['PARAMETERS'] || '';
            const keys = Object.keys(structure).filter(key => key !== 'PARAMETERS');
            keys.forEach(key => {
                if (structure[key]) {
                    lines.push(`${key}: ${structure[key]};`);
                }
            });
            if (params) {
                lines.push(`PARAMETERS: ${params}`);
            }
            return lines.join('\n');
        }

        // í˜„ì¬ í™œì„±í™”ëœ êµ¬ì¡° íƒ­
        let currentStructureTab = 'character';
        
        // êµ¬ì¡° íƒ­ ì „í™˜ í•¨ìˆ˜
        function switchStructureTab(tab) {
            currentStructureTab = tab;
            document.getElementById('structure-tab-character').classList.toggle('active', tab === 'character');
            document.getElementById('structure-tab-general').classList.toggle('active', tab === 'general');
            
            // í˜„ì¬ í”„ë¡¬í”„íŠ¸ ë°ì´í„°ë¡œ ì¹´ë“œ ì¬ìƒì„±
            if (Object.keys(promptData.structuredPrompt).length > 0) {
                createPromptCards(promptData.structuredPrompt);
            }
        }
        
        // ìºë¦­í„° í•˜ìœ„ íƒ­ ì „í™˜ í•¨ìˆ˜
        function switchCharacterSubTab(categoryIndex) {
            // ëª¨ë“  í•˜ìœ„ íƒ­ ë²„íŠ¼ì˜ active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.sub-tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // í´ë¦­ëœ íƒ­ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
            document.querySelector(`.sub-tab-button[data-category="${categoryIndex}"]`)?.classList.add('active');
            
            // ëª¨ë“  ì»¨í…ì¸  ìˆ¨ê¹€
            document.querySelectorAll('.sub-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ì„ íƒëœ ì»¨í…ì¸ ë§Œ í‘œì‹œ
            document.querySelector(`.sub-tab-content[data-category="${categoryIndex}"]`)?.classList.add('active');
        }
        
        // ì¹´ë“œ ìƒì„± í•¨ìˆ˜
        function createPromptCards(structure) {
            promptCardsGrid.innerHTML = '';
            
            // ìºë¦­í„° íƒ­ ì¹´í…Œê³ ë¦¬ (ì´ë¯¸ì§€ ê¸°ì¤€)
            // ìŠ¤íƒ€ì¼ ì˜µì…˜ ëª©ë¡
        const styleOptions = [
            "Aerial", "Analog", "Cinematic", "Documentary", "Drone", "Futuristic", "HDR", "High Key", 
            "Hyperrealistic", "Infrared", "Light Painting", "Lo-fi", "Low Key", "Macro", "Nightscapes", 
            "Noir", "Photorealistic", "Polaroid", "Portrait", "Vintage", "Whimsical", "Surrealistic", 
            "Minimalistic", "Fine Art", "Street", "War/Conflict", "Abstract", "Anime Style", "Cartoon", 
            "Chibi", "Children's Book", "Comic Book", "Concept Art", "Disney Style", "Fantasy Illustration", 
            "Graphic Novel", "Manga", "Pixar", "Studio Ghibli", "Flat Design", "Sketch Style", 
            "Papercut Illustration", "Line Art", "3D Render", "8-bit Art", "CGI", "Cyberpunk", 
            "Digital Painting", "Fractal Art", "Generative Art", "Glitch Art", "Graffiti Art", "Isometric", 
            "Low Poly", "Minimalism", "Neon Art", "Pixel Art", "Pop Art", "Ray Tracing", "Retro", 
            "Synthwave", "Technical Drawing", "Vaporwave", "Vector Art", "Voxel Art", "Acrylic Painting", 
            "Anatomical Drawing", "Art Deco", "Art Nouveau", "Baroque", "Charcoal", "Chinese Ink painting", 
            "Cubism", "Etching", "Expressionism", "Gothic", "Gouache Painting", "Impressionism", 
            "Ink Drawing", "Korean Minhwa", "Oil Painting", "Pastel Drawing", "Pencil Sketch", 
            "Persian Miniature", "Pointillism", "Realistic Painting", "Renaissance", "Rococo", 
            "Romanticism", "Sumi-e", "Ukiyo-e", "Watercolor", "Bauhaus", "Collage", "Dark Fantasy", 
            "Double Exposure", "Fantasy", "Horror", "Installation", "Psychedelic", "Retro-Futurism", 
            "Sacred Geometry", "Sci-Fi", "Stained Glass", "Steampunk", "Surrealism"
        ];
        
        // í•œê¸€ ì œëª© ë§¤í•‘
        const koreanTitles = {
            'STYLE': 'ìŠ¤íƒ€ì¼',
            'MEDIUM': 'ë§¤ì²´',
            'CHARACTER': 'ìºë¦­í„°',
            'CAMERA': 'ì¹´ë©”ë¼',
            'GAZE': 'ì‹œì„ ',
            'CHARACTER_SHEET': 'ìºë¦­í„° ì‹œíŠ¸',
            'BODY_TYPE': 'ì²´í˜•',
            'HAIR': 'í—¤ì–´',
            'FACE_SHAPE': 'ì–¼êµ´í˜•',
            'FACIAL_FEATURES': 'ì–¼êµ´ íŠ¹ì§•',
            'SKIN': 'í”¼ë¶€',
            'EXPRESSION': 'í‘œì •',
            'CLOTHING': 'ì˜ìƒ',
            'ACCESSORIES': 'ì•¡ì„¸ì„œë¦¬',
            'PROPS': 'ì†Œí’ˆ',
            'POSE': 'í¬ì¦ˆ',
            'BACKGROUND': 'ë°°ê²½',
            'LIGHTING': 'ì¡°ëª…',
            'QUALITY': 'í’ˆì§ˆ',
            'PARAMETERS': 'íŒŒë¼ë¯¸í„°'
        };
        
        const characterCategories = [
                { name: 'ê¸°ë³¸ì •ë³´', items: [
                    'STYLE', 'MEDIUM', 'CHARACTER', 'CAMERA', 'GAZE', 'CHARACTER_SHEET'
                ]},
                { name: 'ìºë¦­í„° ì •ë³´', items: [
                    'BODY_TYPE', 'HAIR', 'FACE_SHAPE', 'FACIAL_FEATURES', 'SKIN', 
                    'EXPRESSION', 'CLOTHING', 'ACCESSORIES', 'PROPS', 'POSE'
                ]},
                { name: 'ë°°ê²½/í™˜ê²½ ì •ë³´', items: [
                    'BACKGROUND'
                ]},
                { name: 'ê¸°ìˆ  ì •ë³´', items: [
                    'LIGHTING', 'QUALITY', 'PARAMETERS'
                ]}
            ];
            
            // ì¼ë°˜ì´ë¯¸ì§€ íƒ­ ì¹´í…Œê³ ë¦¬
            const generalCategories = {
                'ê¸°ë³¸ì •ë³´': ['STYLE', 'MEDIUM', 'ERA/CULTURAL_REF', 'CAMERA', 'SCENE', 'COLOR_TONE'],
                'ìºë¦­í„° ì •ë³´': ['CHARACTER_1', 'CHARACTER_1_DETAIL', 'CHARACTER_2', 'CHARACTER_2_DETAIL', 
                               'CHARACTER_3', 'CHARACTER_3_DETAIL', 'CHARACTER_4', 'CHARACTER_4_DETAIL', 
                               'CHARACTER_5', 'CHARACTER_5_DETAIL'],
                'ë°°ê²½/í™˜ê²½ ì •ë³´': ['LOCATION', 'LOCATION_DETAIL', 'TIME_LIGHTING', 'ARTIFICIAL_LIGHT',
                                'ATMOSPHERE', 'WEATHER', 'FOREGROUND', 'BACKGROUND'],
                'ê¸°ìˆ  ì •ë³´': ['CAMERA_EFFECTS', 'LIGHTING_TECHNIQUE', 'CAMERA_TECH', 'QUALITY', 'PARAMETERS']
            };
            
            if (currentStructureTab === 'character') {
                // ìºë¦­í„° íƒ­: í•˜ìœ„ íƒ­ê³¼ í•¨ê»˜ í‘œì‹œ
                const characterContainer = document.createElement('div');
                characterContainer.className = 'character-container';
                
                // ìºë¦­í„° í•˜ìœ„ íƒ­ ìƒì„±
                const subTabs = document.createElement('div');
                subTabs.className = 'character-sub-tabs';
                subTabs.innerHTML = `
                    <div class="sub-tab-buttons">
                        <button type="button" class="sub-tab-button active" data-category="0" onclick="switchCharacterSubTab(0)">ê¸°ë³¸ì •ë³´</button>
                        <button type="button" class="sub-tab-button" data-category="1" onclick="switchCharacterSubTab(1)">ìºë¦­í„° ì •ë³´</button>
                        <button type="button" class="sub-tab-button" data-category="2" onclick="switchCharacterSubTab(2)">ë°°ê²½/í™˜ê²½ì •ë³´</button>
                        <button type="button" class="sub-tab-button" data-category="3" onclick="switchCharacterSubTab(3)">ê¸°ìˆ  ì •ë³´</button>
                    </div>
                `;
                characterContainer.appendChild(subTabs);
                
                // ê° ì¹´í…Œê³ ë¦¬ë³„ ì»¨í…ì¸  ìƒì„±
                const subTabContents = document.createElement('div');
                subTabContents.className = 'sub-tab-contents';
                
                characterCategories.forEach((category, catIndex) => {
                    const content = document.createElement('div');
                    content.className = `sub-tab-content ${catIndex === 0 ? 'active' : ''}`;
                    content.dataset.category = catIndex;
                    
                    let startNumber = 1;
                    if (catIndex === 1) startNumber = 7;  // ìºë¦­í„° ì •ë³´
                    else if (catIndex === 2) startNumber = 17;  // ë°°ê²½/í™˜ê²½ì •ë³´
                    else if (catIndex === 3) startNumber = 18;  // ê¸°ìˆ  ì •ë³´
                    
                    category.items.forEach((key, index) => {
                        const value = structure[key] || '';
                        const itemNumber = startNumber + index;
                        
                        // ë“œë¡­ë‹¤ìš´ ì»¨í…Œì´ë„ˆ ìƒì„±
                        const dropdownContainer = document.createElement('div');
                        dropdownContainer.className = 'dropdown-container';
                        dropdownContainer.dataset.key = key;
                        
                        dropdownContainer.innerHTML = `
                            <div class="dropdown-header" onclick="toggleDropdown(this.parentElement)">
                                <div class="dropdown-title">
                                    <span class="dropdown-number">${itemNumber}</span>
                                    <span>${koreanTitles[key] || key}</span>
                                    <span class="dropdown-english-label">${key}</span>
                                </div>
                                <span class="dropdown-arrow">â–¼</span>
                            </div>
                            <div class="dropdown-content">
                                <div class="dropdown-fields">
                                    <div class="dropdown-field">
                                        <label class="dropdown-field-label">ê¸°ì¡´ë‚´ìš©</label>
                                        <input type="text" 
                                               class="dropdown-field-input" 
                                               value="${value}" 
                                               data-key="${key}" 
                                               onchange="updateStructureValue('${key}', this.value)"
                                               placeholder="ê¸°ì¡´ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”">
                                    </div>
                                    <div class="dropdown-field">
                                        <div class="dropdown-field-label-with-buttons">
                                            <label class="dropdown-field-label">ë³€ê²½ìš”ì²­</label>
                                            <div class="field-action-buttons">
                                                <button type="button" class="btn-field-action btn-save" onclick="saveToApplied('${key}')">ì €ì¥</button>
                                                <button type="button" class="btn-field-action btn-ai-save" onclick="aiSaveField('${key}')">AIì €ì¥</button>
                                            </div>
                                        </div>
                                        ${key === 'STYLE' ? `
                                        <div class="select-input-wrapper">
                                            <input type="text" 
                                                   class="dropdown-field-input with-select" 
                                                   data-key="${key}-request" 
                                                   placeholder="ì§ì ‘ ì…ë ¥ ë˜ëŠ” ì„ íƒ"
                                                   onkeyup="filterStyleOptions(this)">
                                            <button type="button" class="dropdown-toggle-btn" onclick="event.stopPropagation(); toggleStyleDropdown(this)">
                                                <span class="dropdown-icon">â–¼</span>
                                            </button>
                                            <div class="style-options-dropdown" style="display: none;">
                                                <div class="style-options-search">
                                                    <input type="text" placeholder="ìŠ¤íƒ€ì¼ ê²€ìƒ‰..." onkeyup="filterStyleDropdown(this)">
                                                </div>
                                                <div class="style-options-list">
                                                    ${styleOptions.map((option, idx) => 
                                                        `<div class="style-option" role="option" tabindex="-1" data-index="${idx}" onclick="event.stopPropagation(); selectStyleOption(this, '${option}', '${key}-request')">${option}</div>`
                                                    ).join('')}
                                                </div>
                                            </div>
                                        </div>
                                        ` : `
                                        <input type="text" 
                                               class="dropdown-field-input" 
                                               data-key="${key}-request" 
                                               placeholder="ë³€ê²½ ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”">
                                        `}
                                    </div>
                                    <div class="dropdown-field">
                                        <label class="dropdown-field-label">ë³€ê²½ ë°˜ì˜</label>
                                        <input type="text" 
                                               class="dropdown-field-input" 
                                               data-key="${key}-applied" 
                                               placeholder="ë³€ê²½ëœ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”">
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        content.appendChild(dropdownContainer);
                    });
                    
                    subTabContents.appendChild(content);
                });
                
                characterContainer.appendChild(subTabContents);
                promptCardsGrid.appendChild(characterContainer);
                
            } else {
                // ì¼ë°˜ì´ë¯¸ì§€ íƒ­: ê¸°ì¡´ ì¹´ë“œ í˜•íƒœ ìœ ì§€
                const categories = generalCategories;
                Object.entries(categories).forEach(([categoryName, categoryKeys]) => {
                    const section = document.createElement('div');
                    section.className = 'structure-section';
                    
                    const sectionTitle = document.createElement('h4');
                    sectionTitle.className = 'structure-section-title';
                    sectionTitle.textContent = categoryName;
                    section.appendChild(sectionTitle);
                    
                    const sectionGrid = document.createElement('div');
                    sectionGrid.className = 'prompt-cards-grid';
                    
                    categoryKeys.forEach(key => {
                        if (structure.hasOwnProperty(key) || categoryKeys.includes(key)) {
                            const card = document.createElement('div');
                            card.className = 'prompt-card';
                            card.dataset.key = key;
                            
                            const value = structure[key] || '';
                            
                            card.innerHTML = `
                                <div class="prompt-card-header">
                                    <div class="prompt-card-title">${key}</div>
                                    <button class="prompt-card-edit-btn" onclick="editCard('${key}')">âœï¸</button>
                                </div>
                                <div class="prompt-card-content">${value}</div>
                                <textarea class="prompt-card-input" data-key="${key}" onkeydown="handleCardKeydown(event, '${key}')">${value}</textarea>
                                <div class="prompt-card-actions">
                                    <button class="prompt-card-btn prompt-card-save" onclick="saveCard('${key}')">ì €ì¥</button>
                                    <button class="prompt-card-btn prompt-card-cancel" onclick="cancelCard('${key}')">ì·¨ì†Œ</button>
                                </div>
                            `;
                            
                            sectionGrid.appendChild(card);
                        }
                    });
                    
                    // ì„¹ì…˜ì— ì¹´ë“œê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ ì¶”ê°€
                    if (sectionGrid.children.length > 0) {
                        section.appendChild(sectionGrid);
                        promptCardsGrid.appendChild(section);
                    }
                });
            }
            
            // ì¹´í…Œê³ ë¦¬ì— í¬í•¨ë˜ì§€ ì•Šì€ ê¸°íƒ€ í‚¤ë“¤ ì²˜ë¦¬
            // ìºë¦­í„° íƒ­ì—ì„œëŠ” ê¸°íƒ€ í•­ëª© í‘œì‹œí•˜ì§€ ì•ŠìŒ (í•˜ìœ„ íƒ­ìœ¼ë¡œ ì •ë¦¬ë¨)
            if (currentStructureTab !== 'character') {
                const allCategoryKeys = Object.values(generalCategories).flat();
                const otherKeys = Object.keys(structure).filter(key => !allCategoryKeys.includes(key));
                
                if (otherKeys.length > 0) {
                const otherSection = document.createElement('div');
                otherSection.className = 'structure-section';
                
                const sectionTitle = document.createElement('h4');
                sectionTitle.className = 'structure-section-title';
                sectionTitle.textContent = 'ê¸°íƒ€';
                otherSection.appendChild(sectionTitle);
                
                const sectionGrid = document.createElement('div');
                sectionGrid.className = 'prompt-cards-grid';
                
                otherKeys.forEach(key => {
                    const card = document.createElement('div');
                    card.className = 'prompt-card';
                    card.dataset.key = key;
                    
                    card.innerHTML = `
                        <div class="prompt-card-header">
                            <div class="prompt-card-title">${key}</div>
                            <button class="prompt-card-edit-btn" onclick="editCard('${key}')">âœï¸</button>
                        </div>
                        <div class="prompt-card-content">${structure[key]}</div>
                        <textarea class="prompt-card-input" data-key="${key}" onkeydown="handleCardKeydown(event, '${key}')">${structure[key]}</textarea>
                        <div class="prompt-card-actions">
                            <button class="prompt-card-btn prompt-card-save" onclick="saveCard('${key}')">ì €ì¥</button>
                            <button class="prompt-card-btn prompt-card-cancel" onclick="cancelCard('${key}')">ì·¨ì†Œ</button>
                        </div>
                    `;
                    
                    sectionGrid.appendChild(card);
                });
                
                    otherSection.appendChild(sectionGrid);
                    promptCardsGrid.appendChild(otherSection);
                }
            }
            
            promptCardsSection.style.display = 'block';
        }

        // ì¹´ë“œ í¸ì§‘ í•¨ìˆ˜
        function editCard(key) {
            const card = document.querySelector(`.prompt-card[data-key="${key}"]`);
            card.classList.add('editing');
            const input = card.querySelector('.prompt-card-input');
            input.focus();
            input.setSelectionRange(input.value.length, input.value.length);
        }

        // ì¹´ë“œ ì €ì¥ í•¨ìˆ˜
        function saveCard(key) {
            const card = document.querySelector(`.prompt-card[data-key="${key}"]`);
            const input = card.querySelector('.prompt-card-input');
            const content = card.querySelector('.prompt-card-content');
            
            promptData.structuredPrompt[key] = input.value;
            content.textContent = input.value;
            card.classList.remove('editing');
            
            // í”„ë¡¬í”„íŠ¸ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            updatePromptPreview();
            saveToLocalStorage();
        }

        // ì¹´ë“œ ì·¨ì†Œ í•¨ìˆ˜
        function cancelCard(key) {
            const card = document.querySelector(`.prompt-card[data-key="${key}"]`);
            const input = card.querySelector('.prompt-card-input');
            
            input.value = promptData.structuredPrompt[key];
            card.classList.remove('editing');
        }

        // í”„ë¡¬í”„íŠ¸ í‘œì‹œ
        function displayPrompt(prompt) {
            outputText.textContent = prompt;
            outputSection.classList.add('active');
            
            // ìŠ¤í¬ë¡¤
            outputSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // í”„ë¡¬í”„íŠ¸ ë³µì‚¬
        copyPromptBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(outputText.textContent)
                .then(() => {
                    showToast('í”„ë¡¬í”„íŠ¸ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                })
                .catch(() => {
                    showToast('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                });
        });

        // AI ì—°ë™ ë²„íŠ¼ (ë°ëª¨)
        aiConnectBtn.addEventListener('click', () => {
            showToast('AI ì—°ë™ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.', 'info');
        });

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
        function showToast(message, type = 'success') {
            toast.textContent = message;
            toast.className = 'toast show';
            
            if (type === 'error') {
                toast.style.background = 'rgba(239, 68, 68, 0.9)';
            } else if (type === 'info') {
                toast.style.background = 'rgba(59, 130, 246, 0.9)';
            } else {
                toast.style.background = 'rgba(16, 185, 129, 0.9)';
            }
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥
        function saveToLocalStorage() {
            localStorage.setItem('imagePromptData', JSON.stringify(promptData));
        }

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('imagePromptData');
            if (saved) {
                promptData = JSON.parse(saved);
                
                // í…ìŠ¤íŠ¸ ë³µì›
                if (promptData.textInput) {
                    textInput.value = promptData.textInput;
                }
                
                // ì´ë¯¸ì§€ ë³µì›
                if (promptData.imagePreview) {
                    displayImagePreview(promptData.imagePreview);
                }
            }
        }

        // í”„ë¡¬í”„íŠ¸ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updatePromptPreview() {
            const text = textInput.value.trim();
            
            if (!text && !promptData.imageFile && Object.keys(promptData.structuredPrompt).length === 0) {
                if (!userEditingPreview) {
                    promptPreview.innerHTML = '<p class="preview-placeholder">í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ í”„ë¡¬í”„íŠ¸ê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>';
                }
                promptPreview.classList.remove('has-content');
                promptCardsSection.style.display = 'none';
                return;
            }

            let previewText = '';
            
            // êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ê°€ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš© (ì¤„ë°”ê¿ˆ í¬ë§·)
            if (Object.keys(promptData.structuredPrompt).length > 0) {
                previewText = structureToMultilineText(promptData.structuredPrompt);
            } else if (text) {
                // í…ìŠ¤íŠ¸ ê¸°ë°˜ í”„ë¡¬í”„íŠ¸ ë¯¸ë¦¬ë³´ê¸°
                previewText = enhancePrompt(text);
                
                // êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ì¸ì§€ í™•ì¸í•˜ê³  íŒŒì‹±
                if (text.includes(':') && text.includes(';')) {
                    promptData.structuredPrompt = parsePrompt(text);
                    createPromptCards(promptData.structuredPrompt);
                    // êµ¬ì¡°ë¡œ ì¸ì‹ë˜ë©´ ì¤„ë°”ê¿ˆ í¬ë§·ìœ¼ë¡œ í‘œì‹œ
                    previewText = structureToMultilineText(promptData.structuredPrompt);
                } else {
                    promptCardsSection.style.display = 'none';
                }
            }
            
            // ì´ë¯¸ì§€ ì°¸ì¡°ëŠ” êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ì¼ ë•ŒëŠ” ì¶”ê°€í•˜ì§€ ì•ŠìŒ
            if (promptData.imageFile && Object.keys(promptData.structuredPrompt).length === 0) {
                if (previewText) {
                    previewText += '\n\n[ì´ë¯¸ì§€ ì°¸ì¡° í¬í•¨]\n';
                }
                previewText += 'ì—…ë¡œë“œëœ ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ìŠ¤íƒ€ì¼ê³¼ êµ¬ì„±';
            }

            if (!userEditingPreview) {
                promptPreview.textContent = previewText;
            }
            promptPreview.classList.add('has-content');
        }

        // í…ìŠ¤íŠ¸ ì…ë ¥ ì €ì¥ ë° ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        textInput.addEventListener('input', () => {
            promptData.textInput = textInput.value;
            saveToLocalStorage();
            updatePromptPreview();
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë³µì›
        window.addEventListener('load', () => {
            loadFromLocalStorage();
            
            // localStorageì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸ ì„¤ì •
            if (!promptData.textInput && !localStorage.getItem('imagePromptData')) {
                const examplePrompt = `STYLE: 3D animation, Pixar/Disney style render; MEDIUM: CGI 3D animation; CAMERA: wide shot, eye level, professional studio scene; SUBJECT: stick figure character relaxing in director's chair, wearing oversized sunglasses holding whiskey glass, feet up on ottoman, confident relaxed pose; CHARACTER: simple stick figure with round head, thin black line body and limbs, comically oversized designer sunglasses, minimalist yet expressive, wearing suggested white shirt collar and dark pants through simple lines; FURNITURE: plush brown leather director's chair with rounded arms, matching ottoman footrest, luxurious vintage style; PROPS: crystal whiskey glass in stick hand, professional film cameras on tripods, C-stands with lights, reflectors, boom mics, cables on floor; AI ROBOTS: multiple cute robot assistants busily working around studio, one adjusting camera angle, another holding reflector, one operating boom mic, small wheeled robot managing cables, drone robot adjusting overhead light, all with glowing LED eyes and metallic finish; LIGHTING: dramatic studio lighting setup, warm key lights creating amber glow, cool blue fill lights for contrast, multiple light sources visible including softboxes and LED panels, professional photography setup; ENVIRONMENT: professional film studio with visible ceiling grid, white cyc wall, equipment cases, monitors showing footage, busy production atmosphere; ATMOSPHERE: humorous contrast between simple stick figure star and high-tech AI crew, behind-the-scenes movie production vibe, warm and cool color contrast; QUALITY: highly detailed 3D render, professional lighting, cinematic composition --ar 16:9 --v 6`;
                
                textInput.value = examplePrompt;
                promptData.textInput = examplePrompt;
            }
            
            // í…ìŠ¤íŠ¸ ì…ë ¥ì°½ì— ê¸°ë³¸ê°’ì´ ìˆìœ¼ë©´ promptDataì— ì €ì¥
            if (textInput.value.trim()) {
                promptData.textInput = textInput.value.trim();
                
                // êµ¬ì¡°í™”ëœ í”„ë¡¬í”„íŠ¸ì¸ ê²½ìš° ìë™ìœ¼ë¡œ íŒŒì‹±í•˜ì—¬ ì¹´ë“œ ìƒì„±
                const text = textInput.value.trim();
                if (text.includes(':') && text.includes(';')) {
                    promptData.structuredPrompt = parsePrompt(text);
                    createPromptCards(promptData.structuredPrompt);
                }
            }
            
            // êµ¬ì¡° í¸ì§‘ê¸° íƒ­ì„ ê¸°ë³¸ì ìœ¼ë¡œ í‘œì‹œ
            const hasStructuredData = Object.keys(promptData.structuredPrompt).length > 0;
            if (hasStructuredData) {
                // ì €ì¥ëœ êµ¬ì¡°í™” ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¹´ë“œ ìƒì„±
                createPromptCards(promptData.structuredPrompt);
            } else {
                // êµ¬ì¡°í™” ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ í…œí”Œë¦¿ìœ¼ë¡œ ì´ˆê¸°í™”
                const characterTemplate = {
                    'STYLE': '',
                    'MEDIUM': '',
                    'CHARACTER': '',
                    'CAMERA': '',
                    'GAZE': '',
                    'CHARACTER_SHEET': ''
                };
                promptData.structuredPrompt = characterTemplate;
                createPromptCards(characterTemplate);
            }
            promptCardsSection.style.display = 'block';
            
            updatePromptPreview();

            // í”„ë¦¬ë·° ì§ì ‘ ì…ë ¥ ì œì–´
            promptPreview.addEventListener('focus', () => {
                userEditingPreview = true;
            });
            promptPreview.addEventListener('input', () => {
                userEditingPreview = true;
            });
            promptPreview.addEventListener('blur', () => {
                const manualText = (promptPreview.textContent || '').trim();
                userEditingPreview = false;
                if (!manualText) {
                    // ë¹„ì›Œì¡Œìœ¼ë©´ ìƒíƒœ ì´ˆê¸°í™” í›„ ìë™ ë¯¸ë¦¬ë³´ê¸° ë³µêµ¬
                    promptData.structuredPrompt = {};
                    updatePromptPreview();
                    return;
                }
                if (manualText.includes(':') && (manualText.includes(';') || manualText.includes('\n'))) {
                    // êµ¬ì¡°í™” í…ìŠ¤íŠ¸ë¡œ í•´ì„ (ì„¸ë¯¸ì½œë¡  ë˜ëŠ” ì¤„ë°”ê¿ˆ í˜•ì‹)
                    promptData.structuredPrompt = parsePrompt(manualText);
                    createPromptCards(promptData.structuredPrompt);
                    promptCardsSection.style.display = 'block';
                } else {
                    // êµ¬ì¡°í™” ì•„ë‹˜ â†’ ì¹´ë“œ ìˆ¨ê¹€, í…ìŠ¤íŠ¸ë§Œ ìœ ì§€
                    promptData.structuredPrompt = {};
                    promptCardsSection.style.display = 'none';
                }
                saveToLocalStorage();
            });
        });

        // ì¹´ë“œ ì…ë ¥ì°½ í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        function handleCardKeydown(event, key) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                saveCard(key);
            } else if (event.key === 'Escape') {
                event.preventDefault();
                cancelCard(key);
            }
        }

        // í”„ë¡¬í”„íŠ¸ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
        function importPromptFromPreview() {
            const previewText = promptPreview.textContent;
            // ì„¸ë¯¸ì½œë¡  í˜•ì‹ ë˜ëŠ” ì¤„ë°”ê¿ˆ í˜•ì‹ ëª¨ë‘ êµ¬ì¡°í™”ëœ ê²ƒìœ¼ë¡œ ì¸ì‹
            const hasStructured = !!previewText && previewText.includes(':') && 
                                (previewText.includes(';') || previewText.includes('\n'));

            // í”„ë¦¬ë·°ê°€ ë¹„ì—ˆê±°ë‚˜ êµ¬ì¡°í™”ë˜ì§€ ì•Šì€ ê²½ìš°: í˜„ì¬ êµ¬ì¡° í¸ì§‘ê¸° íƒ­ì˜ í…œí”Œë¦¿ ì‚¬ìš©
            if (!previewText || previewText.trim() === '' || !hasStructured) {
                const characterTemplate = {
                    'STYLE': 'professional portrait photography',
                    'MEDIUM': 'high quality photography',
                    'CHARACTER': 'Korean male 28',
                    'CAMERA': 'close-up shot, multiple angles',
                    'CHARACTER_SHEET': 'photo collage of same person, close-up portraits, front face, side profile, 3/4 angle, consistent person',
                    'BODY_TYPE': 'average build, 175cm',
                    'HAIR': 'black short neat side part',
                    'FACE_SHAPE': 'oval',
                    'FACIAL_FEATURES': 'straight eyebrows, dark brown almond eyes, medium nose, natural lips',
                    'SKIN': 'light beige smooth',
                    'EXPRESSION': 'neutral calm',
                    'GAZE': 'varied eye directions for each angle',
                    'CLOTHING': 'navy blue casual t-shirt',
                    'BACKGROUND': 'white background',
                    'LIGHTING': 'professional portrait lighting',
                    'QUALITY': 'high-end photography',
                    'PARAMETERS': '--ar 16:9 --v 6'
                };

                const generalTemplate = {
                    'STYLE': 'cinematic photography',
                    'MEDIUM': 'digital photography',
                    'ERA/CULTURAL_REF': '(ì„ íƒ)',
                    'CAMERA': 'wide shot, low angle',
                    'SCENE': 'two people talking in car during chase',
                    'CHARACTER_1': 'young woman driving, tense expression',
                    'CHARACTER_1_DETAIL': 'ponytail, leather jacket',
                    'CHARACTER_2': 'man in passenger seat, looking back',
                    'CHARACTER_2_DETAIL': 'stubble, white shirt',
                    'CHARACTER_3': '(ì„ íƒ)',
                    'CHARACTER_3_DETAIL': '(ì„ íƒ)',
                    'CHARACTER_4': '(ì„ íƒ)',
                    'CHARACTER_4_DETAIL': '(ì„ íƒ)',
                    'CHARACTER_5': '(ì„ íƒ)',
                    'CHARACTER_5_DETAIL': '(ì„ íƒ)',
                    'CAMERA_EFFECTS': 'motion blur, shallow DOF',
                    'LOCATION': 'city highway at rush hour',
                    'LOCATION_DETAIL': 'inside sedan, leather seats',
                    'TIME_LIGHTING': 'golden hour sunlight',
                    'ARTIFICIAL_LIGHT': 'dashboard glow, street lights',
                    'LIGHTING_TECHNIQUE': 'backlit silhouettes',
                    'ATMOSPHERE': 'tense, urgent',
                    'WEATHER': 'clear',
                    'FOREGROUND': 'dashboard',
                    'BACKGROUND': 'blurred city skyline',
                    'COLOR_TONE': 'warm oranges, deep shadows',
                    'CAMERA_TECH': 'Canon 5D, 24mm lens, f/2.8 (ì„ íƒ)',
                    'QUALITY': 'photorealistic',
                    'PARAMETERS': '--ar 16:9 --v 7'
                };

                const chosen = currentStructureTab === 'character' ? characterTemplate : generalTemplate;
                promptData.structuredPrompt = chosen;
                createPromptCards(chosen);
                promptCardsSection.style.display = 'block';
                // í”„ë¦¬ë·°ëŠ” ì‚¬ìš©ìê°€ ë³´ê³  ìˆëŠ” ë‚´ìš©ì„ ë³´ì¡´í•˜ê¸° ìœ„í•´ ì¦‰ì‹œ ê°±ì‹ í•˜ì§€ ì•ŠìŒ
                showToast('í…œí”Œë¦¿ì„ êµ¬ì¡° í¸ì§‘ê¸°ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤. ê° í•­ëª©ì„ í¸ì§‘í•˜ì„¸ìš”.', 'success');
                return;
            }

            // í”„ë¦¬ë·°ê°€ êµ¬ì¡°í™”ëœ ê²½ìš°: í”„ë¦¬ë·°ë¥¼ íŒŒì‹±í•˜ì—¬ ì¹´ë“œ ìƒì„±
            const parsed = parsePrompt(previewText);
            console.log('ê°€ì ¸ì˜¤ê¸°: íŒŒì‹±ëœ êµ¬ì¡°', parsed);
            
            // íŒŒì‹±ëœ í‚¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì–´ë–¤ íƒ­ì„ ì‚¬ìš©í• ì§€ ìë™ ê°ì§€
            const hasCharacterKeys = ['CHARACTER_SHEET', 'BODY_TYPE', 'HAIR', 'FACE_SHAPE', 'FACIAL_FEATURES', 'SKIN', 'EXPRESSION', 'GAZE'].some(key => parsed[key]);
            const hasGeneralKeys = ['SCENE', 'LOCATION', 'LOCATION_DETAIL', 'TIME_LIGHTING', 'ARTIFICIAL_LIGHT', 'ATMOSPHERE', 'WEATHER', 'FOREGROUND', 'BACKGROUND'].some(key => parsed[key]);
            
            // ìë™ íƒ­ ì „í™˜ (ìºë¦­í„° í‚¤ê°€ ìˆìœ¼ë©´ ìºë¦­í„° íƒ­, ì¼ë°˜ í‚¤ê°€ ìˆìœ¼ë©´ ì¼ë°˜ íƒ­)
            if (hasCharacterKeys && !hasGeneralKeys) {
                switchStructureTab('character');
            } else if (hasGeneralKeys && !hasCharacterKeys) {
                switchStructureTab('general');
            }
            // ë‘˜ ë‹¤ ìˆê±°ë‚˜ ë‘˜ ë‹¤ ì—†ìœ¼ë©´ í˜„ì¬ íƒ­ ìœ ì§€
            
            const defaultKeys = ['STYLE', 'MEDIUM', 'CAMERA', 'SUBJECT', 'CHARACTER', 'FURNITURE', 'PROPS', 'AI ROBOTS', 'LIGHTING', 'ENVIRONMENT', 'ATMOSPHERE', 'QUALITY', 'PARAMETERS'];
            const structuredData = {};
            defaultKeys.forEach(key => { structuredData[key] = parsed[key] || ''; });
            Object.keys(parsed).forEach(key => { if (!defaultKeys.includes(key)) { structuredData[key] = parsed[key]; } });
            promptData.structuredPrompt = structuredData;
            createPromptCards(structuredData);
            promptCardsSection.style.display = 'block';
            // í”„ë¦¬ë·°ëŠ” ì¦‰ì‹œ ê°±ì‹ í•˜ì§€ ì•ŠìŒ (ì‚¬ìš©ì ì…ë ¥ ë³´í˜¸)
            showToast('í”„ë¡¬í”„íŠ¸ë¥¼ êµ¬ì¡° í¸ì§‘ê¸°ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.', 'success');
        }

        // ìºë¦­í„° í…Œì´ë¸” ê°’ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStructureValue(key, value) {
            promptData.structuredPrompt[key] = value;
            saveToLocalStorage();
            
            // í”„ë¡¬í”„íŠ¸ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            if (!userEditingPreview) {
                const multilineText = structureToMultilineText(promptData.structuredPrompt);
                promptPreview.textContent = multilineText;
            }
        }
        
        // ë“œë¡­ë‹¤ìš´ í† ê¸€ í•¨ìˆ˜
        function toggleDropdown(container) {
            container.classList.toggle('active');
        }
        
        // ìŠ¤íƒ€ì¼ ë“œë¡­ë‹¤ìš´ í† ê¸€
        function toggleStyleDropdown(button) {
            event.stopPropagation();
            event.preventDefault();
            
            const wrapper = button.closest('.select-input-wrapper');
            const dropdown = wrapper.querySelector('.style-options-dropdown');
            const isOpen = dropdown.style.display !== 'none';
            
            // ëª¨ë“  ì—´ë¦° ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
            closeAllDropdowns();
            
            if (!isOpen) {
                // ë“œë¡­ë‹¤ìš´ ì—´ê¸°
                dropdown.style.display = 'flex';
                button.classList.add('active');
                activeDropdown = dropdown;
                currentFocusedIndex = -1;
                
                // ARIA ì†ì„± ì„¤ì •
                button.setAttribute('aria-expanded', 'true');
                dropdown.setAttribute('role', 'listbox');
                
                // ê²€ìƒ‰ ì…ë ¥ì°½ì— í¬ì»¤ìŠ¤
                setTimeout(() => {
                    const searchInput = dropdown.querySelector('.style-options-search input');
                    searchInput.focus();
                    
                    // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                    addKeyboardListeners(dropdown, wrapper);
                    
                    // ë“œë¡­ë‹¤ìš´ ë‚´ë¶€ í´ë¦­ ì´ë²¤íŠ¸ ì „íŒŒ ì°¨ë‹¨
                    dropdown.addEventListener('click', (e) => {
                        e.stopPropagation();
                    });
                }, 50);
            }
        }
        
        // ìŠ¤íƒ€ì¼ ì˜µì…˜ ì„ íƒ
        function selectStyleOption(element, value, inputKey) {
            event.stopPropagation();
            event.preventDefault();
            
            const wrapper = element.closest('.select-input-wrapper');
            const input = wrapper.querySelector('.dropdown-field-input');
            const dropdown = wrapper.querySelector('.style-options-dropdown');
            const button = wrapper.querySelector('.dropdown-toggle-btn');
            
            input.value = value;
            input.dispatchEvent(new Event('change'));
            updateStructureValue(inputKey.replace('-request', ''), value);
            
            // ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
            closeDropdown(dropdown, button);
            
            // ì…ë ¥ í•„ë“œë¡œ í¬ì»¤ìŠ¤ ì´ë™
            input.focus();
        }
        
        // ìŠ¤íƒ€ì¼ ë“œë¡­ë‹¤ìš´ í•„í„°ë§
        function filterStyleDropdown(searchInput) {
            const searchValue = searchInput.value.toLowerCase();
            const dropdown = searchInput.closest('.style-options-dropdown');
            const options = dropdown.querySelectorAll('.style-option');
            
            options.forEach(option => {
                const text = option.textContent.toLowerCase();
                if (text.includes(searchValue)) {
                    option.classList.remove('hidden');
                } else {
                    option.classList.add('hidden');
                }
            });
        }
        
        // ì…ë ¥ í•„ë“œì—ì„œ í•„í„°ë§
        function filterStyleOptions(input) {
            const searchValue = input.value.toLowerCase();
            const wrapper = input.closest('.select-input-wrapper');
            const dropdown = wrapper.querySelector('.style-options-dropdown');
            const options = dropdown.querySelectorAll('.style-option');
            
            options.forEach(option => {
                const text = option.textContent.toLowerCase();
                if (text.includes(searchValue)) {
                    option.classList.remove('hidden');
                } else {
                    option.classList.add('hidden');
                }
            });
        }
        
        // ëª¨ë“  ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
        function closeAllDropdowns() {
            document.querySelectorAll('.style-options-dropdown').forEach(dropdown => {
                const button = dropdown.parentElement.querySelector('.dropdown-toggle-btn');
                closeDropdown(dropdown, button);
            });
            activeDropdown = null;
            currentFocusedIndex = -1;
        }
        
        // íŠ¹ì • ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
        function closeDropdown(dropdown, button) {
            dropdown.style.display = 'none';
            button.classList.remove('active');
            button.setAttribute('aria-expanded', 'false');
            
            // í¬ì»¤ìŠ¤ëœ ì˜µì…˜ ìŠ¤íƒ€ì¼ ì œê±°
            dropdown.querySelectorAll('.style-option').forEach(option => {
                option.classList.remove('focused');
            });
        }
        
        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        function addKeyboardListeners(dropdown, wrapper) {
            const searchInput = dropdown.querySelector('.style-options-search input');
            const input = wrapper.querySelector('.dropdown-field-input');
            
            // ê²€ìƒ‰ ì…ë ¥ì°½ í‚¤ë³´ë“œ ì´ë²¤íŠ¸
            searchInput.addEventListener('keydown', (e) => {
                handleDropdownKeyboard(e, dropdown, wrapper);
            });
            
            // ë“œë¡­ë‹¤ìš´ ì „ì²´ í‚¤ë³´ë“œ ì´ë²¤íŠ¸
            dropdown.addEventListener('keydown', (e) => {
                handleDropdownKeyboard(e, dropdown, wrapper);
            });
        }
        
        // ë“œë¡­ë‹¤ìš´ í‚¤ë³´ë“œ í•¸ë“¤ëŸ¬
        function handleDropdownKeyboard(e, dropdown, wrapper) {
            const options = Array.from(dropdown.querySelectorAll('.style-option:not(.hidden)'));
            const button = wrapper.querySelector('.dropdown-toggle-btn');
            
            switch(e.key) {
                case 'ArrowDown':
                    e.preventDefault();
                    currentFocusedIndex = Math.min(currentFocusedIndex + 1, options.length - 1);
                    updateFocusedOption(options);
                    break;
                    
                case 'ArrowUp':
                    e.preventDefault();
                    currentFocusedIndex = Math.max(currentFocusedIndex - 1, -1);
                    updateFocusedOption(options);
                    break;
                    
                case 'Enter':
                    e.preventDefault();
                    if (currentFocusedIndex >= 0 && options[currentFocusedIndex]) {
                        options[currentFocusedIndex].click();
                    }
                    break;
                    
                case 'Escape':
                    e.preventDefault();
                    closeDropdown(dropdown, button);
                    wrapper.querySelector('.dropdown-field-input').focus();
                    break;
                    
                case 'Tab':
                    // Tab í‚¤ëŠ” ë“œë¡­ë‹¤ìš´ì„ ë‹«ê³  ë‹¤ìŒ ìš”ì†Œë¡œ ì´ë™
                    e.preventDefault();
                    closeDropdown(dropdown, button);
                    break;
            }
        }
        
        // í¬ì»¤ìŠ¤ëœ ì˜µì…˜ ì—…ë°ì´íŠ¸
        function updateFocusedOption(options) {
            options.forEach((option, index) => {
                if (index === currentFocusedIndex) {
                    option.classList.add('focused');
                    option.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
                } else {
                    option.classList.remove('focused');
                }
            });
        }
        
        // í´ë¦­ ì™¸ë¶€ ì˜ì—­ ì²˜ë¦¬
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.select-input-wrapper')) {
                closeAllDropdowns();
            }
        });
        
        // ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œ ë³€ê²½ìš”ì²­ ê°’ì„ ë³€ê²½ë°˜ì˜ìœ¼ë¡œ ë³µì‚¬
        function saveToApplied(key) {
            // í˜„ì¬ í™œì„±í™”ëœ ë“œë¡­ë‹¤ìš´ ì»¨í…Œì´ë„ˆ ì°¾ê¸°
            const activeContainer = document.querySelector('.dropdown-container.active');
            if (!activeContainer) return;
            
            // ë³€ê²½ìš”ì²­ ì…ë ¥ í•„ë“œ ì°¾ê¸°
            const requestInput = activeContainer.querySelector(`input[data-key="${key}-request"]`);
            const appliedInput = activeContainer.querySelector(`input[data-key="${key}-applied"]`);
            
            if (requestInput && appliedInput && requestInput.value.trim()) {
                // ë³€ê²½ìš”ì²­ ê°’ì„ ë³€ê²½ë°˜ì˜ìœ¼ë¡œ ë³µì‚¬
                appliedInput.value = requestInput.value;
                appliedInput.dispatchEvent(new Event('change'));
                
                // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ
                showToast('ë³€ê²½ìš”ì²­ ë‚´ìš©ì´ ë³€ê²½ë°˜ì˜ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                
                // ì˜µì…˜: ë³€ê²½ìš”ì²­ í•„ë“œ ì´ˆê¸°í™”
                // requestInput.value = '';
            } else if (!requestInput.value.trim()) {
                showToast('ë³€ê²½ìš”ì²­ ë‚´ìš©ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            }
        }
        
        // AIì €ì¥ ë²„íŠ¼ ê¸°ëŠ¥ (ì¶”í›„ êµ¬í˜„)
        function aiSaveField(key) {
            // AI ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •
            showToast('AI ì €ì¥ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.', 'info');
        }
        
        // window ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡ (ì¸ë¼ì¸ onclickìš©)
        window.removeImage = removeImage;
        window.editCard = editCard;
        window.saveCard = saveCard;
        window.cancelCard = cancelCard;
        window.importPromptFromPreview = importPromptFromPreview;
        window.handleCardKeydown = handleCardKeydown;
        window.switchStructureTab = switchStructureTab;
        window.switchCharacterSubTab = switchCharacterSubTab;
        window.updateStructureValue = updateStructureValue;
        window.toggleDropdown = toggleDropdown;
        window.toggleStyleDropdown = toggleStyleDropdown;
        window.selectStyleOption = selectStyleOption;
        window.saveToApplied = saveToApplied;
        window.aiSaveField = aiSaveField;
        window.filterStyleDropdown = filterStyleDropdown;
        window.filterStyleOptions = filterStyleOptions;
    </script>
    
</body>
</html>